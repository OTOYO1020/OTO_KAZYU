{
    "id": "openstack%2Fglance~stable%2Fdiablo~Ic8b78be5dce2281c80372ed446499f6d0bc07f40",
    "project": "openstack/glance",
    "branch": "stable/diablo",
    "hashtags": [],
    "change_id": "Ic8b78be5dce2281c80372ed446499f6d0bc07f40",
    "subject": "Secondary iteration of fix for bug 891738",
    "status": "ABANDONED",
    "created": "2012-01-06 08:54:18.000000000",
    "updated": "2012-01-11 06:43:23.000000000",
    "insertions": 99,
    "deletions": 29,
    "total_comment_count": 0,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "ad4ebf3f10d58257b4a7f84b62d9cf4a31daceab",
    "_number": 2864,
    "owner": {
        "_account_id": 1247,
        "name": "Mark McLoughlin",
        "email": "markmc@redhat.com",
        "username": "markmc"
    },
    "labels": {
        "Verified": {
            "all": [
                {
                    "_account_id": 1390,
                    "name": "Paul Bourke",
                    "email": "pauldbourke@proton.me",
                    "username": "pauldbourke"
                },
                {
                    "_account_id": 1247,
                    "name": "Mark McLoughlin",
                    "email": "markmc@redhat.com",
                    "username": "markmc"
                },
                {
                    "_account_id": 7,
                    "name": "Jay Pipes",
                    "email": "jaypipes@gmail.com",
                    "username": "jaypipes"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "rejected": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "disliked": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "all": [
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 1390,
                    "name": "Paul Bourke",
                    "email": "pauldbourke@proton.me",
                    "username": "pauldbourke"
                },
                {
                    "value": -2,
                    "date": "2012-01-11 06:43:01.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 1247,
                    "name": "Mark McLoughlin",
                    "email": "markmc@redhat.com",
                    "username": "markmc"
                },
                {
                    "value": -1,
                    "date": "2012-01-06 14:30:07.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 7,
                    "name": "Jay Pipes",
                    "email": "jaypipes@gmail.com",
                    "username": "jaypipes"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "value": -1,
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "all": [
                {
                    "date": "2012-01-06 08:54:18.000000000",
                    "_account_id": 1390,
                    "name": "Paul Bourke",
                    "email": "pauldbourke@proton.me",
                    "username": "pauldbourke"
                },
                {
                    "value": 0,
                    "date": "2012-01-06 09:22:49.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 0
                    },
                    "_account_id": 1247,
                    "name": "Mark McLoughlin",
                    "email": "markmc@redhat.com",
                    "username": "markmc"
                },
                {
                    "_account_id": 7,
                    "name": "Jay Pipes",
                    "email": "jaypipes@gmail.com",
                    "username": "jaypipes"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "_account_id": 1390,
                    "name": "Paul Bourke",
                    "email": "pauldbourke@proton.me",
                    "username": "pauldbourke"
                },
                {
                    "_account_id": 1247,
                    "name": "Mark McLoughlin",
                    "email": "markmc@redhat.com",
                    "username": "markmc"
                },
                {
                    "_account_id": 7,
                    "name": "Jay Pipes",
                    "email": "jaypipes@gmail.com",
                    "username": "jaypipes"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            {
                "_account_id": 1390,
                "name": "Paul Bourke",
                "email": "pauldbourke@proton.me",
                "username": "pauldbourke"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2012-01-06 08:54:18.000000000",
            "updated_by": {
                "_account_id": 1390,
                "name": "Paul Bourke",
                "email": "pauldbourke@proton.me",
                "username": "pauldbourke"
            },
            "reviewer": {
                "_account_id": 1390,
                "name": "Paul Bourke",
                "email": "pauldbourke@proton.me",
                "username": "pauldbourke"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2012-01-06 14:30:07.000000000",
            "updated_by": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "reviewer": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "state": "REVIEWER"
        }
    ],
    "messages": [
        {
            "id": "b42929da7644acf069fc4c5c217582904e2735ed",
            "author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "real_author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "date": "2012-01-06 09:22:49.000000000",
            "message": "Patch Set 1: Looks good to me (core reviewer)\n\nWe're backporting the first part, so may as well backport the second part.\n    \nLooks like a scarey change, but it's actually straightforward.\n\nPart 2 of 3 related swift backend fixes",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "8db8c7f19fd2fa337269859663900d7c7ccb199e",
            "author": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "real_author": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "date": "2012-01-06 14:30:07.000000000",
            "message": "Patch Set 1: I would prefer that you didn't submit this\n\nEwan Mellor actually rewrote this particular piece of code to be simpler and a bit more performant. I would prefer to backport his work instead (or on top of this patch?):\n\nhttps://review.openstack.org/#change,2728",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "1d84c3d86e5867f60afca2c92e90699a74087d5b",
            "author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "real_author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "date": "2012-01-06 14:36:12.000000000",
            "message": "Patch Set 1:\n\nI'd actually be more inclined to drop all the patches related to this stuff. If it's needed this much work since Diablo, it sounds like it was pretty much a non-feature in Diablo and fixing it fully would be more like backporting a whole new feature to Diablo.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "de0f742afbe2812326dd0b56f5a3da7927613150",
            "author": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "real_author": {
                "_account_id": 7,
                "name": "Jay Pipes",
                "email": "jaypipes@gmail.com",
                "username": "jaypipes"
            },
            "date": "2012-01-06 14:59:38.000000000",
            "message": "Patch Set 1:\n\nNo, it's not so dramatic :) Really, the existing code (and this patch) evolved the way it did because of an unfortunate series of discoveries about the Webob library -- or more specifically, how the Webob library determines the size of the request body.\n\nAt one point, we figured out that Swift did not accept objects larger than 5GB without using this \"object manifest upload\" method. However, at that time, we were still allowing the Glance client to upload chunked-transfer-encoded BLOBs without specifying the Content-Length header (as it is NOT required to be set for chunked-transfer encoded requests). In addition, we found out that if we attempted to make the Webob.Request.body seekable, that webob would ready the entire request body into memory, which caused some major OOM bugs for us with Windows images. Not good.\n\nUnfortunately, what this meant was that there was no way for the Swift storage driver to tell if a request was going to exceed the 5GB limit and thus need to write segments of data to Swift and then an object manifest file. And so, we wrote code that, when seeing an image size of 0 (if no Content-Length was specified), we created a temporary disk buffer and wrote a chunk of the incoming image to disk and then supplied that seekable disk-based file descriptor to the Swift client's put_object() method, calculating the image's checksum along the way as we wrote the segments to the disk buffer.\n\nThis particular patch addressed a bug in that disk-buffer code that was incorrectly setting the image_size in the registry database to 0 if the image_size passed to the Swift driver was 0 (unknown).\n\nHowever, when Ewan went to fix a bug that was introduced a few patches back, he came up with a simple and innovative way of getting rid of the disk buffer entirely. His solution removes the prior assumption that images <5G must be written to Swift using a single put_object() call and he removed the need for a disk buffer by adding a simple call to delete 0-sized chunks (which end up being created if the image_size passed to the Swift driver is 0 (unknown))\n\nLong explanation, but that's the story of why this code looked the way it did and why I'm happier with Ewan's patch to replace this bit of code :)\n\nCheers,\n-jay",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "e584c0d7c42d2c4ed268fca70a82da56d3941e19",
            "author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "real_author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "date": "2012-01-11 06:43:01.000000000",
            "message": "Patch Set 1: Do not submit\n\nOk, I'm going to abandon this for now and see how Ewan's version settles down on master.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "359100987d24077b97cd5a0fc1b5df3e7ac130c1",
            "author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "real_author": {
                "_account_id": 1247,
                "name": "Mark McLoughlin",
                "email": "markmc@redhat.com",
                "username": "markmc"
            },
            "date": "2012-01-11 06:43:23.000000000",
            "message": "Patch Set 1: Abandoned\n\nWaiting for this area to settle down on master",
            "accounts_in_message": [],
            "_revision_number": 1
        }
    ],
    "requirements": [],
    "submit_records": []
}
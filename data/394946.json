{
    "id": "openstack%2Fglance~master~I66d6f2c57d1ccd086f941fc9e3764b4cc321241f",
    "project": "openstack/glance",
    "branch": "master",
    "topic": "bug/1599123",
    "hashtags": [],
    "change_id": "I66d6f2c57d1ccd086f941fc9e3764b4cc321241f",
    "subject": "IPv6 fix in Glance for malformed URLs.",
    "status": "MERGED",
    "created": "2016-11-08 12:53:43.000000000",
    "updated": "2016-11-28 17:17:29.000000000",
    "submitted": "2016-11-28 15:02:30.000000000",
    "submitter": {
        "_account_id": 3,
        "name": "Jenkins",
        "username": "jenkins"
    },
    "insertions": 124,
    "deletions": 5,
    "total_comment_count": 1,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "9fb2c467dd22d76daa36b949ac8e2916337384e3",
    "_number": 394946,
    "owner": {
        "_account_id": 22584,
        "name": "Tomislav Sukser",
        "email": "tomislav.sukser@telekom.de",
        "username": "tsukser"
    },
    "labels": {
        "Verified": {
            "approved": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "all": [
                {
                    "value": 0,
                    "_account_id": 8158,
                    "name": "Hemanth Makkapati",
                    "email": "makstacker+osgerrit@gmail.com",
                    "username": "hemanth.makkapati"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 0,
                    "_account_id": 22584,
                    "name": "Tomislav Sukser",
                    "email": "tomislav.sukser@telekom.de",
                    "username": "tsukser"
                },
                {
                    "value": 0,
                    "_account_id": 21722,
                    "name": "Dharini Chandrasekar",
                    "email": "dharini.chandrasekar@intel.com",
                    "username": "dharinic"
                },
                {
                    "value": 0,
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 5202,
                    "name": "Erno Kuvaja",
                    "email": "jokke@usr.fi",
                    "username": "jokke"
                },
                {
                    "value": 0,
                    "_account_id": 5314,
                    "name": "Brian Rosmaita",
                    "email": "rosmaita.fossdev@gmail.com",
                    "username": "brian-rosmaita"
                },
                {
                    "value": 2,
                    "date": "2016-11-28 15:02:30.000000000",
                    "post_submit": true,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "approved": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "recommended": {
                "_account_id": 21722,
                "name": "Dharini Chandrasekar",
                "email": "dharini.chandrasekar@intel.com",
                "username": "dharinic"
            },
            "all": [
                {
                    "value": 0,
                    "_account_id": 8158,
                    "name": "Hemanth Makkapati",
                    "email": "makstacker+osgerrit@gmail.com",
                    "username": "hemanth.makkapati"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 0,
                    "_account_id": 22584,
                    "name": "Tomislav Sukser",
                    "email": "tomislav.sukser@telekom.de",
                    "username": "tsukser"
                },
                {
                    "value": 1,
                    "date": "2016-11-22 20:07:37.000000000",
                    "permitted_voting_range": {
                        "min": 1,
                        "max": 1
                    },
                    "_account_id": 21722,
                    "name": "Dharini Chandrasekar",
                    "email": "dharini.chandrasekar@intel.com",
                    "username": "dharinic"
                },
                {
                    "value": 2,
                    "date": "2016-11-16 10:40:00.000000000",
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 5202,
                    "name": "Erno Kuvaja",
                    "email": "jokke@usr.fi",
                    "username": "jokke"
                },
                {
                    "value": 2,
                    "date": "2016-11-28 14:06:28.000000000",
                    "permitted_voting_range": {
                        "min": 2,
                        "max": 2
                    },
                    "_account_id": 5314,
                    "name": "Brian Rosmaita",
                    "email": "rosmaita.fossdev@gmail.com",
                    "username": "brian-rosmaita"
                },
                {
                    "value": 0,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "value": 1,
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "approved": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "all": [
                {
                    "value": 0,
                    "_account_id": 8158,
                    "name": "Hemanth Makkapati",
                    "email": "makstacker+osgerrit@gmail.com",
                    "username": "hemanth.makkapati"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 0,
                    "_account_id": 22584,
                    "name": "Tomislav Sukser",
                    "email": "tomislav.sukser@telekom.de",
                    "username": "tsukser"
                },
                {
                    "value": 0,
                    "_account_id": 21722,
                    "name": "Dharini Chandrasekar",
                    "email": "dharini.chandrasekar@intel.com",
                    "username": "dharinic"
                },
                {
                    "value": 0,
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 5202,
                    "name": "Erno Kuvaja",
                    "email": "jokke@usr.fi",
                    "username": "jokke"
                },
                {
                    "value": 1,
                    "date": "2016-11-28 14:06:28.000000000",
                    "permitted_voting_range": {
                        "min": 1,
                        "max": 1
                    },
                    "_account_id": 5314,
                    "name": "Brian Rosmaita",
                    "email": "rosmaita.fossdev@gmail.com",
                    "username": "brian-rosmaita"
                },
                {
                    "value": 0,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "value": 0,
                    "_account_id": 8158,
                    "name": "Hemanth Makkapati",
                    "email": "makstacker+osgerrit@gmail.com",
                    "username": "hemanth.makkapati"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 0,
                    "_account_id": 22584,
                    "name": "Tomislav Sukser",
                    "email": "tomislav.sukser@telekom.de",
                    "username": "tsukser"
                },
                {
                    "value": 0,
                    "_account_id": 21722,
                    "name": "Dharini Chandrasekar",
                    "email": "dharini.chandrasekar@intel.com",
                    "username": "dharinic"
                },
                {
                    "value": 0,
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 5202,
                    "name": "Erno Kuvaja",
                    "email": "jokke@usr.fi",
                    "username": "jokke"
                },
                {
                    "value": 0,
                    "_account_id": 5314,
                    "name": "Brian Rosmaita",
                    "email": "rosmaita.fossdev@gmail.com",
                    "username": "brian-rosmaita"
                },
                {
                    "value": 0,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            {
                "_account_id": 5202,
                "name": "Erno Kuvaja",
                "email": "jokke@usr.fi",
                "username": "jokke"
            },
            {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            {
                "_account_id": 21722,
                "name": "Dharini Chandrasekar",
                "email": "dharini.chandrasekar@intel.com",
                "username": "dharinic"
            },
            {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2016-11-08 13:00:49.000000000",
            "updated_by": {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            "reviewer": {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-11-08 13:01:40.000000000",
            "updated_by": {
                "_account_id": 5202,
                "name": "Erno Kuvaja",
                "email": "jokke@usr.fi",
                "username": "jokke"
            },
            "reviewer": {
                "_account_id": 5202,
                "name": "Erno Kuvaja",
                "email": "jokke@usr.fi",
                "username": "jokke"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-11-08 15:20:47.000000000",
            "updated_by": {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            "reviewer": {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-11-16 10:40:00.000000000",
            "updated_by": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "reviewer": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-11-22 20:07:37.000000000",
            "updated_by": {
                "_account_id": 21722,
                "name": "Dharini Chandrasekar",
                "email": "dharini.chandrasekar@intel.com",
                "username": "dharinic"
            },
            "reviewer": {
                "_account_id": 21722,
                "name": "Dharini Chandrasekar",
                "email": "dharini.chandrasekar@intel.com",
                "username": "dharinic"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-11-28 14:06:28.000000000",
            "updated_by": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "reviewer": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-11-28 15:02:30.000000000",
            "updated_by": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "reviewer": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "state": "REVIEWER"
        }
    ],
    "messages": [
        {
            "id": "c92dd984e8787f7a1755aec6ae4ce1e08e237f4b",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-08 12:53:43.000000000",
            "message": "Uploaded patch set 1.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "e33aea2702c0dca108494ecd3e51f823df2ec807",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-08 12:58:52.000000000",
            "message": "Uploaded patch set 2: Commit message was updated.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "278060a7c100f3d360610e93031d05edd2ad6d52",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-08 12:59:58.000000000",
            "message": "Uploaded patch set 3: Commit message was updated.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "54c2303b36b21839b027a03042614dbb0223bd7f",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-11-08 13:52:04.000000000",
            "message": "Patch Set 3: Verified-1\n\nBuild failed (check pipeline).  For information on how to proceed, see http://docs.openstack.org/infra/manual/developers.html#automated-testing\n\n- gate-glance-python34-db http://logs.openstack.org/46/394946/3/check/gate-glance-python34-db/0b18497/ : SUCCESS in 3m 58s\n- gate-glance-python35-db-nv http://logs.openstack.org/46/394946/3/check/gate-glance-python35-db-nv/bd32d53/ : FAILURE in 45m 56s (non-voting)\n- gate-glance-docs-ubuntu-xenial http://docs-draft.openstack.org/46/394946/3/check/gate-glance-docs-ubuntu-xenial/e2ade16//doc/build/html/ : SUCCESS in 6m 50s\n- gate-glance-pep8-ubuntu-xenial http://logs.openstack.org/46/394946/3/check/gate-glance-pep8-ubuntu-xenial/9e61710/ : SUCCESS in 2m 46s\n- gate-glance-python27-db-ubuntu-xenial http://logs.openstack.org/46/394946/3/check/gate-glance-python27-db-ubuntu-xenial/2216cd8/ : SUCCESS in 10m 37s\n- gate-tempest-dsvm-neutron-full-ubuntu-xenial http://logs.openstack.org/46/394946/3/check/gate-tempest-dsvm-neutron-full-ubuntu-xenial/926a1b7/ : SUCCESS in 48m 44s\n- gate-grenade-dsvm-neutron-ubuntu-xenial http://logs.openstack.org/46/394946/3/check/gate-grenade-dsvm-neutron-ubuntu-xenial/ae0116c/ : SUCCESS in 34m 15s\n- gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial http://logs.openstack.org/46/394946/3/check/gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial/a5a64c3/ : FAILURE in 50m 25s\n- gate-tempest-dsvm-neutron-identity-v3-only-full-ubuntu-xenial-nv http://logs.openstack.org/46/394946/3/check/gate-tempest-dsvm-neutron-identity-v3-only-full-ubuntu-xenial-nv/86fa4a6/ : SUCCESS in 50m 16s (non-voting)\n- gate-rally-dsvm-glance http://logs.openstack.org/46/394946/3/check/gate-rally-dsvm-glance/44e2530/ : SUCCESS in 30m 44s (non-voting)",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "414146ceabcf21be3a997814f379ee3349e1f3bc",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-11-08 14:21:49.000000000",
            "message": "Patch Set 3: Code-Review+1\n\nHey Tomislav,\n\nI think this makes sense.\n\nThere seems to be some prior art for the glance host (as opposed to the registry host here) in nova for example:\n\n nova/nova/image/glance.py\n\n def generate_glance_url():\n     \"\"\"Generate the URL to glance.\"\"\"\n     glance_host = CONF.glance.host\n     if netutils.is_valid_ipv6(glance_host):\n         glance_host = '[%s]' % glance_host\n     return \"%s://%s:%d\" % (CONF.glance.protocol, glance_host,\n                            CONF.glance.port)\n\nOne question: have you thought about adding test(s)?\n\nA test which prevented a regression of bug 1599123 (ie prevented ipv6 breaking in glance) would be super -- if at all possible.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "aec98c9aa706c650aeb693c8225b14d096a15fd1",
            "author": {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            "real_author": {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            "date": "2016-11-08 15:20:47.000000000",
            "message": "Patch Set 3: Code-Review-1\n\nThanks, Tomislav.\nThis looks good but let's add some tests like Stuart suggested.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "80219e575323e16d3f3cff51f8ae70ec1cfdd443",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-08 15:35:55.000000000",
            "message": "Patch Set 3:\n\nHi Stuart, Hemanth,\n\nThanks for the review!\n\nI'm afraid that loading hostname within [] if it is IPv6 address could lead to other problems because many other points failed when I modified configuration file and included the address in [].\n\nI would be happy to include a test, but I cannot figure out what would be the best starting point. Currently the testing which I'm doing is with the real installation (either packaged or pulled from upstream) and that's not suitable here since it would require practically a build script for complete OpenStack environment covering all core services (running on pure IPv6). I could add the test for the specific function (_construct_url), but I'm not sure if that one alone would make much sense either.\n\nCould you please point me to some specific point where such (IPv6) testing would fit best? It seems I'm unable to find any good starting point for introduction of IPv6 only tests for APIs, I can only find tests for tenant side.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "192836d8933a09ffccd335741a75dfcdce29ef6d",
            "author": {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            "real_author": {
                "_account_id": 8158,
                "name": "Hemanth Makkapati",
                "email": "makstacker+osgerrit@gmail.com",
                "username": "hemanth.makkapati"
            },
            "date": "2016-11-08 16:09:08.000000000",
            "message": "Patch Set 3:\n\nTomislav,\nThanks for looking into adding tests.\nHere [0] are some unit tests for the client. But, like you said unit tests don't serve the purpose much here except that we maybe able to validate that the ipv6 address is indeed wrapped with [].\n\nI'm wondering if we could add functional tests that can talk to a glance service via ::1 ?\nYou think that would help? Here [1] are some client functional tests you maybe able to get an idea from.\n\n[0] https://github.com/openstack/glance/blob/master/glance/tests/unit/common/test_client.py\n[1] https://github.com/openstack/glance/blob/master/glance/tests/functional/test_client_exceptions.py",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "3ce1b6b4eec125309c2f1394c41d3933c42ee1de",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-11-08 16:44:48.000000000",
            "message": "Patch Set 3:\n\nIdeally we want to verify the API->Registry call, which is where I think things fall over.\n\n\n\nSomething based on the v2 functional image tests which use the v2 registry [1], a bit like this (not tested):\n\n http://paste.openstack.org/show/588408/\n\nmight be one way to do it.\n\n\n[1] glance/glance/tests/functional/v2/test_images.py",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "467d3813b47c8c614548075cdbd6b91880d17a2b",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-10 09:47:06.000000000",
            "message": "Patch Set 3:\n\nHi Stewart, Hemanth,\n\nThanks a lot for the example and references!\n\nI tried developing further on Stewart's example [1] and improved it [2]. That caused further issues since testing suite seems to be hardcoded to use 127.0.0.1 for testing purposes, so I introduced parameters for bind_host in [3]. That still didn't help, since 127.0.0.1 and AF_INET were hardcoded in [4], so I made temporary change [5] just to run this test.\n\nAll these changes broke other tests, which was expected, however I got at least this particular test to run. The test run without patch from patch set 3 resulted in [6], and after fix was applied test was successful [7]. In addition, log files from the test show proper URL creation [8]. Please note that logs were collected from multiple tests, so it's possible that not all of them match together (if doing port comparison).\n\nI believe it would be appropriate to introduce parameter (to signal which IP stack is the test about) in base class which would be used for the test and to adapt utils.py [4]. Another approach would be to introduce optional parameter for functions get_unused_port and get_unused_port_and_socket, e.g. bind_host which can be set to '127.0.0.1' as default. What would be most appropriate approach here?\n\n[1] http://paste.openstack.org/show/588408/\n[2] http://paste.openstack.org/show/588680/\n[3] http://paste.openstack.org/show/588681/\n[4] https://github.com/openstack/glance/blob/master/glance/tests/utils.py\n[5] http://paste.openstack.org/show/588682/\n[6] http://paste.openstack.org/show/588683/\n[7] http://paste.openstack.org/show/588684/\n[8] http://paste.openstack.org/show/588685/",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "3d1cf5bc3ab0c02942a2a7abdd10e57647e5c15a",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-11-10 10:27:01.000000000",
            "message": "Patch Set 3:\n\nHi Tomislav,\n\nUnfortunately, I'm not working on Glance so much anymore, so have limited time to help out. :-/\n\nOne thing I'll say is, it might be worth looking at the test in test_reload.py. \n\nIt has functions to write out the parameter values in the api.conf\n\n set_config_value(self._conffile('api'), key, value)\n\nor registry.conf\n\nset_config_value(self._conffile('registry'), key, value)\n\nfiles used during test.\n\nIt appears to allow setting the bind_host:\n\n set_config_value(self._conffile('api'), 'bind_host', '127.0.0.1')\n\nI'm not sure what the behaviour of this would be if called before \"start_servers\", but it might be worth trying.\n\nI appreciate that the test code is fairly complex to try to understand + not documented etc etc.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "4d2e6b00e2888a7939d51423b46ad179493fc719",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-15 16:10:20.000000000",
            "message": "Uploaded patch set 4.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "42ed04998a21c4192fdc285118ada7ede1bb6790",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-15 16:11:18.000000000",
            "message": "Patch Set 4:\n\n> Uploaded patch set 4.\n\nHi,\n\nThanks a lot for hints a support so far!\n\nI was able to track the root cause for this weird behavior. Configuration files for test servers are written correctly, however, the setup of FunctionalTest does not support binding to anything else than 127.0.0.1 since this is executed earlier in the process of testing and supports only IPv4 (AF_INET). I added functions and methods for IPv6: __init__.py:FunctionalTest.ping_server_ipv6 [1], tests/utils.py:get_unused_port_ipv6 and tests/utils.py:get_unused_port_and_socket_ipv6 [2]. During this specific test related to IPv6, the original functions are monkey patched (replaced) by IPv6 version of mentioned functions and reverted once test is done.\n\nTest also shows behavior from bug #1599123 - 500 status code, if the test is run before this patch itself, result which I ran locally is here [3].\n\n[1] https://github.com/openstack/glance/blob/master/glance/tests/functional/__init__.py\n[2] https://github.com/openstack/glance/blob/master/glance/tests/utils.py\n[3] http://paste.openstack.org/show/589292/",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "783b88ea8cba441993ca85cd364163a7da09e217",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-11-15 17:29:35.000000000",
            "message": "Patch Set 4: Verified+1\n\nBuild succeeded (check pipeline).\n\n- gate-glance-python34-db http://logs.openstack.org/46/394946/4/check/gate-glance-python34-db/bda5499/ : SUCCESS in 3m 37s\n- gate-glance-python35-db-nv http://logs.openstack.org/46/394946/4/check/gate-glance-python35-db-nv/91da828/ : FAILURE in 45m 23s (non-voting)\n- gate-glance-docs-ubuntu-xenial http://docs-draft.openstack.org/46/394946/4/check/gate-glance-docs-ubuntu-xenial/73fd174//doc/build/html/ : SUCCESS in 5m 11s\n- gate-glance-pep8-ubuntu-xenial http://logs.openstack.org/46/394946/4/check/gate-glance-pep8-ubuntu-xenial/a208be7/ : SUCCESS in 3m 05s\n- gate-glance-python27-db-ubuntu-xenial http://logs.openstack.org/46/394946/4/check/gate-glance-python27-db-ubuntu-xenial/e1dbd32/ : SUCCESS in 7m 46s\n- gate-tempest-dsvm-neutron-full-ubuntu-xenial http://logs.openstack.org/46/394946/4/check/gate-tempest-dsvm-neutron-full-ubuntu-xenial/bc51627/ : SUCCESS in 46m 04s\n- gate-grenade-dsvm-neutron-ubuntu-xenial http://logs.openstack.org/46/394946/4/check/gate-grenade-dsvm-neutron-ubuntu-xenial/9922d58/ : SUCCESS in 31m 57s\n- gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial http://logs.openstack.org/46/394946/4/check/gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial/2d141eb/ : SUCCESS in 1h 16m 44s\n- gate-tempest-dsvm-neutron-identity-v3-only-full-ubuntu-xenial-nv http://logs.openstack.org/46/394946/4/check/gate-tempest-dsvm-neutron-identity-v3-only-full-ubuntu-xenial-nv/62d5b5d/ : SUCCESS in 1h 08m 35s (non-voting)\n- gate-rally-dsvm-glance http://logs.openstack.org/46/394946/4/check/gate-rally-dsvm-glance/ba7ff13/ : SUCCESS in 28m 50s (non-voting)",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "8139122babdd4841635014dbda60073bafb79817",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-11-15 18:10:55.000000000",
            "message": "Patch Set 4: Code-Review+1\n\nNice job Tomislav :-)\n\nYour ipv6 test is a great addition.\n\nCan you confirm that if you revert your change to glance/common/client.py that your test fails?\n\nIf so, this looks good to go.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "c1d457b9f43fa27100299392699db7ed4e983eda",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-16 07:23:47.000000000",
            "message": "Patch Set 4:\n\nHi Stuart,\n\nThanks a lot!\n\nI can confirm that reverting changes to glance/common/client.py makes test fail, I ran test locally:\nhttp://paste.openstack.org/show/589368/\n\nWhole paste in a nutshell - if I revert changes to glance/common/client.py (e.g. by taking file from master), test fails with reporting HTTP error 500 (assertion 500 != 200) and api.log has:\n    Constructed URL: http://::1:51819/rpc _construct_url glance/common/client.py:398\nwhile with my patch test succeeds (which means HTTP code 200) and api.log shows:\n    Constructed URL: http://[::1]:36153/rpc _construct_url glance/common/client.py:402",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "195d27fab4a3969d903e03bc5edabf622cfd92e1",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-11-16 10:40:00.000000000",
            "message": "Patch Set 4: Code-Review+2\n\nGreat, thanks!",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "c89ebc839cc48b93ac2e7887039a9c2391b5a8cd",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-11-16 10:52:59.000000000",
            "message": "Patch Set 4:\n\n(1 comment)",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "7db3ed6fdf4677ca0d5aa72db446b15f43bed408",
            "author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "real_author": {
                "_account_id": 22584,
                "name": "Tomislav Sukser",
                "email": "tomislav.sukser@telekom.de",
                "username": "tsukser"
            },
            "date": "2016-11-16 12:17:59.000000000",
            "message": "Patch Set 4:\n\n> (1 comment)\n\nIndeed, this would be feasible, but would mean in the end that there's more code to maintain since certain methods would be duplicated.\n\nIt also crossed my mind that I can introduce a new optional parameter in functions get_unused_port and get_unused_port_and_socket in glance/tests/utils.py, e.g. ip_version which would default to 4. And in addition, FunctionalTest class could have additional member (variable) of similar name meaning which would have to be set properly (overridden) before calling setUp. This would definitely improve chances to switch from IPv4 to IPv6 for the whole testing suite with simple change of default value once IPv6 becomes used more often.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "70a8757a1b9b0fcd157b50731c6db667630ad63b",
            "author": {
                "_account_id": 21722,
                "name": "Dharini Chandrasekar",
                "email": "dharini.chandrasekar@intel.com",
                "username": "dharinic"
            },
            "real_author": {
                "_account_id": 21722,
                "name": "Dharini Chandrasekar",
                "email": "dharini.chandrasekar@intel.com",
                "username": "dharinic"
            },
            "date": "2016-11-22 20:07:37.000000000",
            "message": "Patch Set 4: Code-Review+1\n\nThe change looks good to me. I agree with Stuart that we can have a subclass for ipv6 testing. However, this change looks good to me, to go with the way the current tests are written.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "045deef0051505fe3f32969da518ac99363af326",
            "author": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "real_author": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "date": "2016-11-28 14:06:28.000000000",
            "message": "Patch Set 4: Code-Review+2 Workflow+1\n\nNice work, Tomislav.  Thanks for adding the clearly documented tests.\n\nI agree with Stuart and Dharini that a subclass could be introduced for ipv6 functional testing to avoid the monkey patches, but I agree that it shouldn't be a blocker for this particular patch.  I'll add a bug after this merges about refactoring along the lines Stuart mentions, and someone learning their way around the tests can pick it up as low hanging fruit.\n\nJust want to mention that square brackets are required around IPv6 addresses in URLs by RFC 3986, section 3.2.2.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "45375381da9f697c5ca87f5257c684e1613a6d04",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-11-28 14:06:49.000000000",
            "message": "Patch Set 4: -Verified\n\nStarting gate jobs.\nhttp://status.openstack.org/zuul/",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "a6d33e6ad82cf19cb903f45bc0545a5d68ca6c8d",
            "date": "2016-11-28 15:02:30.000000000",
            "message": "Change has been successfully merged into the git repository by Jenkins",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "1b3e850a80e5ea56735b54f74422d91e4039b62d",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-11-28 15:02:30.000000000",
            "message": "Patch Set 4: Verified+2\n\nBuild succeeded (gate pipeline).\n\n- gate-glance-python34-db http://logs.openstack.org/46/394946/4/gate/gate-glance-python34-db/13304c6/ : SUCCESS in 4m 29s\n- gate-glance-docs-ubuntu-xenial http://docs-draft.openstack.org/46/394946/4/gate/gate-glance-docs-ubuntu-xenial/6f6c5f9//doc/build/html/ : SUCCESS in 7m 25s\n- gate-glance-pep8-ubuntu-xenial http://logs.openstack.org/46/394946/4/gate/gate-glance-pep8-ubuntu-xenial/f6f522b/ : SUCCESS in 3m 11s\n- gate-glance-python27-db-ubuntu-xenial http://logs.openstack.org/46/394946/4/gate/gate-glance-python27-db-ubuntu-xenial/df85269/ : SUCCESS in 7m 10s\n- gate-tempest-dsvm-neutron-full-ubuntu-xenial http://logs.openstack.org/46/394946/4/gate/gate-tempest-dsvm-neutron-full-ubuntu-xenial/c2cd6c3/ : SUCCESS in 51m 29s\n- gate-grenade-dsvm-neutron-ubuntu-xenial http://logs.openstack.org/46/394946/4/gate/gate-grenade-dsvm-neutron-ubuntu-xenial/9bfed09/ : SUCCESS in 54m 34s\n- gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial http://logs.openstack.org/46/394946/4/gate/gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial/29e7912/ : SUCCESS in 51m 36s",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "599a5ca8865943c3f8d1cf324ba2b4d55b2a99cf",
            "author": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "real_author": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "date": "2016-11-28 17:17:29.000000000",
            "message": "Patch Set 4:\n\nThe refactoring bug I said I'd file as a followup is: https://bugs.launchpad.net/glance/+bug/1645392",
            "accounts_in_message": [],
            "_revision_number": 4
        }
    ],
    "requirements": [],
    "submit_records": []
}
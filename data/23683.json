{
    "id": "openstack%2Fglance~master~I604c67d2d6ecd77a12e11b2f641edb4095c4bb60",
    "project": "openstack/glance",
    "branch": "master",
    "topic": "bug/1147231",
    "hashtags": [],
    "change_id": "I604c67d2d6ecd77a12e11b2f641edb4095c4bb60",
    "subject": "Fix v2 data upload to swift",
    "status": "MERGED",
    "created": "2013-03-06 11:08:11.000000000",
    "updated": "2013-03-07 18:51:39.000000000",
    "submitted": "2013-03-07 18:51:38.000000000",
    "submitter": {
        "_account_id": 3,
        "name": "Jenkins",
        "username": "jenkins"
    },
    "insertions": 2,
    "deletions": 2,
    "total_comment_count": 0,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "a94ee475172af2bf98a7a8d5b7fb255adf617094",
    "_number": 23683,
    "owner": {
        "_account_id": 455,
        "name": "Stuart McLaren",
        "email": "stuart.mclaren@hpe.com",
        "username": "stuart-mclaren"
    },
    "labels": {
        "Verified": {
            "approved": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "all": [
                {
                    "value": 0,
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "value": 0,
                    "_account_id": 6493,
                    "name": "John Bresnahan",
                    "email": "john@bresnahan.me",
                    "username": "jbresnah"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 0,
                    "_account_id": 616,
                    "name": "Mark Washenberger",
                    "email": "mark.washenberger@markwash.net",
                    "username": "markwash"
                },
                {
                    "value": 0,
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 2,
                    "date": "2013-03-07 18:51:38.000000000",
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "approved": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "all": [
                {
                    "value": 2,
                    "date": "2013-03-07 16:58:10.000000000",
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "value": 1,
                    "date": "2013-03-07 17:11:14.000000000",
                    "permitted_voting_range": {
                        "min": 1,
                        "max": 1
                    },
                    "_account_id": 6493,
                    "name": "John Bresnahan",
                    "email": "john@bresnahan.me",
                    "username": "jbresnah"
                },
                {
                    "value": 1,
                    "date": "2013-03-06 20:06:06.000000000",
                    "permitted_voting_range": {
                        "min": 1,
                        "max": 1
                    },
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 2,
                    "date": "2013-03-07 18:14:28.000000000",
                    "_account_id": 616,
                    "name": "Mark Washenberger",
                    "email": "mark.washenberger@markwash.net",
                    "username": "markwash"
                },
                {
                    "value": 0,
                    "date": "2013-03-07 10:08:44.000000000",
                    "permitted_voting_range": {
                        "min": 0,
                        "max": 1
                    },
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "approved": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "all": [
                {
                    "value": 0,
                    "date": "2013-03-07 16:58:10.000000000",
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "value": 0,
                    "_account_id": 6493,
                    "name": "John Bresnahan",
                    "email": "john@bresnahan.me",
                    "username": "jbresnah"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 1,
                    "date": "2013-03-07 18:14:28.000000000",
                    "_account_id": 616,
                    "name": "Mark Washenberger",
                    "email": "mark.washenberger@markwash.net",
                    "username": "markwash"
                },
                {
                    "value": 0,
                    "date": "2013-03-06 14:29:24.000000000",
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "value": 0,
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "value": 0,
                    "_account_id": 6493,
                    "name": "John Bresnahan",
                    "email": "john@bresnahan.me",
                    "username": "jbresnah"
                },
                {
                    "value": 0,
                    "_account_id": 6159,
                    "name": "Flavio Percoco",
                    "display_name": "flaper87",
                    "email": "fpercoco@redhat.com",
                    "username": "flaper87"
                },
                {
                    "value": 0,
                    "_account_id": 616,
                    "name": "Mark Washenberger",
                    "email": "mark.washenberger@markwash.net",
                    "username": "markwash"
                },
                {
                    "value": 0,
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2013-03-06 20:06:06.000000000",
            "updated_by": {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            "reviewer": {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-03-07 16:58:10.000000000",
            "updated_by": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "reviewer": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-03-07 17:11:14.000000000",
            "updated_by": {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            },
            "reviewer": {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-03-07 18:14:28.000000000",
            "updated_by": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "reviewer": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-03-07 18:51:38.000000000",
            "updated_by": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "reviewer": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "state": "REVIEWER"
        }
    ],
    "messages": [
        {
            "id": "df54f52a327e2956e6ba22a738421d5cf64553db",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-03-06 11:29:58.000000000",
            "message": "Patch Set 1: Doesn't seem to work\n\nBuild failed.  For information on how to proceed, see https://wiki.openstack.org/wiki/GerritJenkinsGithub#Test_Failures\n\n- http://logs.openstack.org/23683/1/check/gate-glance-pep8/4000 : SUCCESS\n- http://logs.openstack.org/23683/1/check/gate-glance-docs/2050 : SUCCESS\n- http://logs.openstack.org/23683/1/check/gate-glance-python26/3477 : SUCCESS\n- http://logs.openstack.org/23683/1/check/gate-glance-python27/3501 : SUCCESS\n- http://logs.openstack.org/23683/1/check/gate-tempest-devstack-vm-full/7364 : FAILURE\n- http://logs.openstack.org/23683/1/check/gate-tempest-devstack-vm-postgres-full/7080 : FAILURE\n- http://logs.openstack.org/23683/1/check/gate-tempest-devstack-vm-quantum/12426 : FAILURE\n",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "f71cb54a61bcadf202bbcc60fa3b302ce8524631",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-03-06 14:29:24.000000000",
            "message": "Uploaded patch set 2.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "257c1d0f14a814f1eef7f7ab7338daff6437ce86",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-03-06 15:08:55.000000000",
            "message": "Patch Set 2: Works for me\n\nBuild succeeded.\n\n- http://logs.openstack.org/23683/2/check/gate-glance-pep8/4001 : SUCCESS\n- http://logs.openstack.org/23683/2/check/gate-glance-docs/2052 : SUCCESS\n- http://logs.openstack.org/23683/2/check/gate-glance-python26/3479 : SUCCESS\n- http://logs.openstack.org/23683/2/check/gate-glance-python27/3503 : SUCCESS\n- http://logs.openstack.org/23683/2/check/gate-tempest-devstack-vm-full/7381 : SUCCESS\n- http://logs.openstack.org/23683/2/check/gate-tempest-devstack-vm-postgres-full/7097 : SUCCESS\n- http://logs.openstack.org/23683/2/check/gate-tempest-devstack-vm-quantum/12446 : SUCCESS\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "d65dd22a592a40dfe4756fda4505d7218b90a1ae",
            "author": {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            },
            "real_author": {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            },
            "date": "2013-03-06 18:48:43.000000000",
            "message": "Patch Set 2:\n\nI wonder if the len() method should be added to the CooperativeReader object instead of having the test inspect its fd data member.  If the test expects this behavior of the object perhaps other future things would as well.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "e472c29be4345550974b3345964a809ffd08a464",
            "author": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "real_author": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "date": "2013-03-06 18:52:43.000000000",
            "message": "Patch Set 2:\n\nThanks! And sorry for the bug.\n\nI think John's suggestion makes a lot of sense.\n\nOn the bug ticket, you looked at putting the call to CooperativeReader in the controller, IIRC. Can you comment on the change to putting in the storage domain layer?\n\nThanks again!",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "32b8f1d2fd8d5a64e84d6ab641cbcaad0049cf84",
            "author": {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            "real_author": {
                "_account_id": 6159,
                "name": "Flavio Percoco",
                "display_name": "flaper87",
                "email": "fpercoco@redhat.com",
                "username": "flaper87"
            },
            "date": "2013-03-06 20:06:06.000000000",
            "message": "Patch Set 2: Looks good to me, but someone else must approve\n\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "5e3d005fca077716ac1c238c92181291b0ab8021",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-03-07 10:08:44.000000000",
            "message": "Patch Set 2:\n\nRe: len() method\n\n So if you add this it breaks v1 upload to swift :-)\n\n I think swift inspects what methods are available\n and if it sees a len it makes certain assumptions.\n As far as I can tell CooperativeReader would need\n to have a len method that always works, but that's not possible\n since there's no guarantee that the underlying fd will have a\n working len method. If you start to look at dynamically\n adding a method to the class you can still run into problems\n since if swift inspects the class to see if the method exists\n rather than an instance of the class this can lead to unexpected\n behaviour. In short I didn't see a way to do this using a couple\n of lines (I tried 'setattr', various __len__ tricks and\n MethodType) -- if noone else can either it probably merits a\n separate commit.\n\nRe: putting CooperativeReader in the storage domain layer\n\n I think I felt that this should be closer to the storage layer\n ie that anytime we're pushing data into the store (whether\n via the Controller or not) it should go through a CooperativeReader.\n Its a judgement call though -- I'm happy to put back in the Controller\n if you think that's best.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "9e176b0c75e4863a862e43edc80604c23fd25b29",
            "author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "real_author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "date": "2013-03-07 16:58:10.000000000",
            "message": "Patch Set 2: Looks good to me (core reviewer)\n\nFunctionally tested in devstack.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "3fbc913ad0e76f6915dd66d6bdc506bd6bb3379d",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-03-07 17:06:21.000000000",
            "message": "Patch Set 2:\n\nFWIW I've asked for a test for this in tempest (https://bugs.launchpad.net/tempest/+bug/1149928)",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "7cb2a0aa277e0f639d4387d6835bec9db54422cc",
            "author": {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            },
            "real_author": {
                "_account_id": 6493,
                "name": "John Bresnahan",
                "email": "john@bresnahan.me",
                "username": "jbresnah"
            },
            "date": "2013-03-07 17:11:14.000000000",
            "message": "Patch Set 2: Looks good to me, but someone else must approve\n\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "b5155262b47526b2c82f709e54108c1423df7b39",
            "author": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "real_author": {
                "_account_id": 616,
                "name": "Mark Washenberger",
                "email": "mark.washenberger@markwash.net",
                "username": "markwash"
            },
            "date": "2013-03-07 18:14:28.000000000",
            "message": "Patch Set 2: Looks good to me (core reviewer); Approved\n\nStuart:\n\nI'd at least like to move the \"Cooperative\" part out of the domain--since the domain really shouldn't be specific to eventlet or any other framework. And I think in general the domain set_data method should have a very clear expectation of what \"data\" is (a file or an iterable, not both), and do as much as possible to hide the idiosyncrasies of swiftclient in glance/store/swift.py. But these are wish-list items for me, so lets get this great fix in.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "b5d38cd433f76eb16a71028a0675b3968ba50f52",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-03-07 18:14:31.000000000",
            "message": "Patch Set 2: No score\n\nStarting gate jobs.\nhttp://status.openstack.org/zuul/",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "6c08137d8400b076d91b22e1a50962ab7e992750",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-03-07 18:51:38.000000000",
            "message": "Patch Set 2: Verified\n\nBuild succeeded.\n\n- http://logs.openstack.org/23683/2/gate/gate-glance-docs/2075 : SUCCESS\n- http://logs.openstack.org/23683/2/gate/gate-glance-pep8/4030 : SUCCESS\n- http://logs.openstack.org/23683/2/gate/gate-glance-python26/3502 : SUCCESS\n- http://logs.openstack.org/23683/2/gate/gate-glance-python27/3526 : SUCCESS\n- http://logs.openstack.org/23683/2/gate/gate-tempest-devstack-vm-full/7617 : SUCCESS\n- http://logs.openstack.org/23683/2/gate/gate-tempest-devstack-vm-postgres-full/7333 : SUCCESS\n- http://logs.openstack.org/23683/2/gate/gate-tempest-devstack-vm-quantum/12721 : SUCCESS\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "0914ad7afb31c2dad895f014a9f8a9535685793f",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-03-07 18:51:39.000000000",
            "message": "Change has been successfully merged into the git repository.",
            "accounts_in_message": [],
            "_revision_number": 2
        }
    ],
    "requirements": [],
    "submit_records": []
}
{
    "id": "openstack%2Fglance~master~I418cfba08263868a181b7dd3f10251ee886cc4ce",
    "project": "openstack/glance",
    "branch": "master",
    "topic": "import-refactor-newton",
    "hashtags": [],
    "change_id": "I418cfba08263868a181b7dd3f10251ee886cc4ce",
    "subject": "[WIP] Image import: prototype /import implementation",
    "status": "ABANDONED",
    "created": "2016-05-04 17:36:19.000000000",
    "updated": "2022-01-04 04:31:03.000000000",
    "insertions": 230,
    "deletions": 1,
    "total_comment_count": 1,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "ea177a33b0050e098414b27e994c5e670de0fe34",
    "_number": 312653,
    "owner": {
        "_account_id": 455,
        "name": "Stuart McLaren",
        "email": "stuart.mclaren@hpe.com",
        "username": "stuart-mclaren"
    },
    "labels": {
        "Verified": {
            "all": [
                {
                    "_account_id": 2537,
                    "name": "Nikhil Komawar",
                    "email": "nik.komawar@gmail.com",
                    "username": "nikhil-komawar"
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "disliked": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "all": [
                {
                    "value": -1,
                    "date": "2016-05-09 22:19:47.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 2537,
                    "name": "Nikhil Komawar",
                    "email": "nik.komawar@gmail.com",
                    "username": "nikhil-komawar"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "value": -1,
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "all": [
                {
                    "_account_id": 2537,
                    "name": "Nikhil Komawar",
                    "email": "nik.komawar@gmail.com",
                    "username": "nikhil-komawar"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 0
                    },
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "_account_id": 2537,
                    "name": "Nikhil Komawar",
                    "email": "nik.komawar@gmail.com",
                    "username": "nikhil-komawar"
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2016-05-05 14:54:13.000000000",
            "updated_by": {
                "_account_id": 15054,
                "name": "wangxiyuan",
                "email": "wangxiyuan1007@gmail.com",
                "username": "wangxiyuan"
            },
            "reviewer": {
                "_account_id": 15054,
                "name": "wangxiyuan",
                "email": "wangxiyuan1007@gmail.com",
                "username": "wangxiyuan"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2016-05-09 22:19:47.000000000",
            "updated_by": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "reviewer": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2021-12-21 06:45:54.000000000",
            "updated_by": {
                "_account_id": 15054,
                "name": "wangxiyuan",
                "email": "wangxiyuan1007@gmail.com",
                "username": "wangxiyuan"
            },
            "reviewer": {
                "_account_id": 15054,
                "name": "wangxiyuan",
                "email": "wangxiyuan1007@gmail.com",
                "username": "wangxiyuan"
            },
            "state": "REMOVED"
        }
    ],
    "messages": [
        {
            "id": "758c4e4d40ce5c5d5204703aa4a735c3dbf68fb2",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-05-04 17:36:19.000000000",
            "message": "Uploaded patch set 1.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "6e86f57ff25a27711438adb76bb4a61e7a74bbe6",
            "author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "real_author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "date": "2016-05-04 18:01:21.000000000",
            "message": "Patch Set 1:\n\nIf memory serves me correct, what we agreed at the summit was:\n\n1. MVP -- something that includes NULL plugin first and then basic plugins later.\n2. Persistence -- this needs state machine that can be accomplished by using the tasks DB tables.\n3. Orchestration -- once persistence is done or is being done in parallel we can leverage the state machine for tasks to accomplish this.\n\nAs far as taskflow goes, I am debating on the good and bads of it.\n\nIt definitely helps with entry points, it helps with setting up flows that are easy to comprehend and expand.\n\nBut let's not make it a first step. Let's roll with a NULL plugin first. What we agreed to was to introduce a spec that will elaborate on this mechanism. We can involve others like josh harlow who can take input from us to simplify taskflow for us to use. I had a brief chat with Alex Meade who is doing something similar for cinder and he was a bit negative on using taskflow but I think we are using it, we've the expertise for it and we can iterate over it in Newton -- separately from the import spec.\n\nHope that makes sense.\n\n---\n\nCan we mark it WIP so as to avoid confusion with other (not so directly involved stakeholders)? I also get that the commit message conveys that info.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "0f7b615dd22aff57a09e731341acc609cdbbcc81",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-05-04 19:26:04.000000000",
            "message": "Patch Set 1: Verified+1\n\nBuild succeeded (check pipeline).\n\n- gate-glance-python34-db http://logs.openstack.org/53/312653/1/check/gate-glance-python34-db/1e52ff3/ : SUCCESS in 5m 39s\n- gate-glance-docs http://docs-draft.openstack.org/53/312653/1/check/gate-glance-docs/06665e9//doc/build/html/ : SUCCESS in 8m 16s\n- gate-glance-pep8 http://logs.openstack.org/53/312653/1/check/gate-glance-pep8/456e143/ : SUCCESS in 2m 20s\n- gate-glance-python27-db http://logs.openstack.org/53/312653/1/check/gate-glance-python27-db/79d260b/ : SUCCESS in 7m 44s\n- gate-tempest-dsvm-full http://logs.openstack.org/53/312653/1/check/gate-tempest-dsvm-full/4f29942/ : SUCCESS in 36m 05s\n- gate-tempest-dsvm-postgres-full http://logs.openstack.org/53/312653/1/check/gate-tempest-dsvm-postgres-full/d70a857/ : SUCCESS in 32m 52s\n- gate-tempest-dsvm-neutron-full http://logs.openstack.org/53/312653/1/check/gate-tempest-dsvm-neutron-full/9d034b8/ : SUCCESS in 1h 24m 34s\n- gate-grenade-dsvm http://logs.openstack.org/53/312653/1/check/gate-grenade-dsvm/e63be32/ : SUCCESS in 36m 41s\n- gate-tempest-dsvm-full-devstack-plugin-ceph http://logs.openstack.org/53/312653/1/check/gate-tempest-dsvm-full-devstack-plugin-ceph/449fdde/ : SUCCESS in 59m 13s\n- gate-tempest-dsvm-neutron-identity-v3-only-full-nv http://logs.openstack.org/53/312653/1/check/gate-tempest-dsvm-neutron-identity-v3-only-full-nv/6cd7ed7/ : SUCCESS in 1h 33m 14s (non-voting)\n- gate-rally-dsvm-glance http://logs.openstack.org/53/312653/1/check/gate-rally-dsvm-glance/2f54687/ : SUCCESS in 32m 59s (non-voting)",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "92cd6ccc5ff1e35588ed7329f94623a240fc0153",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-05-05 09:41:17.000000000",
            "message": "Patch Set 1:\n\nMy questions all relate to MVP.\n\nI'm going to add numbers to help identify responses.\n\n1. How much of the existing glance task stuff (note, I'm not asking about task flow) should we re-use?\n\n2. Do we want to create a glance task in the database for each import call? (If so, why?)\n\n3. Do we need to re-use all the TaskFactory/TaskFactoryProxy stuff for example, or could we reuse the image factory/proxy and plug more directly into task flow?\n\n4. Are we expecting to just have a very thin wrapper around the existing task implementation? Or something new (which could potentially work if glance tasks were pulled from the code base)?\n\n5. More generally, did folks have any expectations/preferences on what the overall code implementation for MVP would look like? (What files/classes/functions should be created for example.)\n\nThe goal here is to avoid implementing something and then finding out that people expected something which was structured totally differently.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "a740e5e14e8249947b1b1691c70129cd7ff23471",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-05-06 14:58:16.000000000",
            "message": "Uploaded patch set 2.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "2b28c15af295b73b7fc12fc7a4a6be81a6fa41e1",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-05-06 16:03:40.000000000",
            "message": "Patch Set 2: Verified+1\n\nBuild succeeded (check pipeline).\n\n- gate-glance-python34-db http://logs.openstack.org/53/312653/2/check/gate-glance-python34-db/e51fcc0/ : SUCCESS in 5m 46s\n- gate-glance-docs http://docs-draft.openstack.org/53/312653/2/check/gate-glance-docs/262ed2f//doc/build/html/ : SUCCESS in 12m 48s\n- gate-glance-pep8 http://logs.openstack.org/53/312653/2/check/gate-glance-pep8/a92323a/ : SUCCESS in 3m 08s\n- gate-glance-python27-db http://logs.openstack.org/53/312653/2/check/gate-glance-python27-db/652041a/ : SUCCESS in 7m 08s\n- gate-tempest-dsvm-full http://logs.openstack.org/53/312653/2/check/gate-tempest-dsvm-full/d0a3b39/ : SUCCESS in 52m 56s\n- gate-tempest-dsvm-postgres-full http://logs.openstack.org/53/312653/2/check/gate-tempest-dsvm-postgres-full/bbd458a/ : SUCCESS in 37m 43s\n- gate-tempest-dsvm-neutron-full http://logs.openstack.org/53/312653/2/check/gate-tempest-dsvm-neutron-full/68dbfb9/ : SUCCESS in 58m 28s\n- gate-grenade-dsvm http://logs.openstack.org/53/312653/2/check/gate-grenade-dsvm/38ced08/ : SUCCESS in 41m 48s\n- gate-tempest-dsvm-full-devstack-plugin-ceph http://logs.openstack.org/53/312653/2/check/gate-tempest-dsvm-full-devstack-plugin-ceph/f1fb0aa/ : SUCCESS in 46m 41s\n- gate-tempest-dsvm-neutron-identity-v3-only-full-nv http://logs.openstack.org/53/312653/2/check/gate-tempest-dsvm-neutron-identity-v3-only-full-nv/b152d29/ : SUCCESS in 1h 00m 22s (non-voting)\n- gate-rally-dsvm-glance http://logs.openstack.org/53/312653/2/check/gate-rally-dsvm-glance/e456013/ : SUCCESS in 42m 08s (non-voting)",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "08f23216b366376a1fed5ce876a892efdda49dcc",
            "author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "real_author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "date": "2016-05-09 22:19:47.000000000",
            "message": "Patch Set 2: Code-Review-1\n\n>>> 1. How much of the existing glance task stuff (note, I'm not asking about task flow) should we re-use?\n\nFor MVP, none. As we agreed that a MVP would start with a NULL plugin and then add on simplistic plugins that would retry the entire workflow, when re-triggered by the user, in case of a failed import call. We do not need persistence or orchestration, both of which rely on tasks tables. The NULL and simplistic plugins won't need the transaction semantics of the existing tasks workflow.\n\n2. Do we want to create a glance task in the database for each import call? (If so, why?)\n\nNo, for the reasons described above. A first implementation doesn't need this (DB) logic.\n\n3. Do we need to re-use all the TaskFactory/TaskFactoryProxy stuff for example, or could we reuse the image factory/proxy and plug more directly into task flow?\n\nFor starters, we introduce a ImportFactory class at the domain level. This is abstraction logic that doesn't have to deal with the API, it should be called by the API when a import call is made by the user. So, in the future a refactor to this logic won't affect the API. The existing tasks could be used by admins in real world use cases for say ova import; I think tying down top level import with the task based admin ova import will be confusing. \n\n(Future stuff) When we have a full fledged import capability for the /v2/import we can re-use the existing stuff to converge on the use cases.\n\n4. Are we expecting to just have a very thin wrapper around the existing task implementation? Or something new (which could potentially work if glance tasks were pulled from the code base)?\n\nSomething new like described above.\n\n5. More generally, did folks have any expectations/preferences on what the overall code implementation for MVP would look like? (What files/classes/functions should be created for example.)\n\n* API for top level import, that goes in its own file glance/api/v2/image_import.py if possible. The WSGI wrappers need to act friendly for this. Otherwise, this going in images.py is fine.\n\n* You will need to go around the entire merry-go-round of gateway, db, domain, proxy etc. if you want to add this.\n\n* The image.image_import() logic sound good to me. It should provide a good separation of concerns for this DefCore specific implementation.\n\n* The business logic to implement more complex tasks patterns should be handled as a separate spec.\n\nThe goal here is to avoid implementing something and then finding out that people expected something which was structured totally differently.\n\n--\n\nI see the tests pass here but we need a closer look at the image statuses and the commit intent.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "a8d8c3cb44a7de4784ec5e28fbf5e0bb44a955a2",
            "author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "real_author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "date": "2016-05-09 22:20:19.000000000",
            "message": "Patch Set 2:\n\n(1 comment)",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "669a5e7678ee6856b3373cae8975328766a4be7c",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-06-21 16:12:44.000000000",
            "message": "Patch Set 2: Verified-1\n\nMerge Failed.\n\nThis change or one of its cross-repo dependencies was unable to be automatically merged with the current state of its repository. Please rebase the change and upload a new patchset.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "be22a1c49ef1b8178279178054b3437ff83a79ca",
            "author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "real_author": {
                "_account_id": 2537,
                "name": "Nikhil Komawar",
                "email": "nik.komawar@gmail.com",
                "username": "nikhil-komawar"
            },
            "date": "2016-08-15 19:16:26.000000000",
            "message": "Topic changed from import-wip-4 to import-refactor-newton",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "109dbb86768ad5b4ab504ae49c5a4b3156007226",
            "author": {
                "_account_id": 5263,
                "name": "Jeremy Stanley",
                "display_name": "fungi",
                "email": "fungi@yuggoth.org",
                "username": "fungi",
                "status": "missing, presumed fed"
            },
            "real_author": {
                "_account_id": 5263,
                "name": "Jeremy Stanley",
                "display_name": "fungi",
                "email": "fungi@yuggoth.org",
                "username": "fungi",
                "status": "missing, presumed fed"
            },
            "date": "2017-12-18 04:56:29.000000000",
            "message": "Removed reviewer Jenkins with the following votes:\n\n* Verified-1 by Jenkins (3)\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "0bd76ec79df893272d94abb80239cf3983e91fe1",
            "tag": "autogenerated:gerrit:deleteReviewer",
            "author": {
                "_account_id": 15054,
                "name": "wangxiyuan",
                "email": "wangxiyuan1007@gmail.com",
                "username": "wangxiyuan"
            },
            "real_author": {
                "_account_id": 15054,
                "name": "wangxiyuan",
                "email": "wangxiyuan1007@gmail.com",
                "username": "wangxiyuan"
            },
            "date": "2021-12-21 06:45:54.000000000",
            "message": "Removed reviewer wangxiyuan.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "ea177a33b0050e098414b27e994c5e670de0fe34",
            "tag": "autogenerated:gerrit:abandon",
            "author": {
                "_account_id": 9303,
                "name": "Abhishek Kekane",
                "email": "akekane@redhat.com",
                "username": "abhishekkekane"
            },
            "real_author": {
                "_account_id": 9303,
                "name": "Abhishek Kekane",
                "email": "akekane@redhat.com",
                "username": "abhishekkekane"
            },
            "date": "2022-01-04 04:31:03.000000000",
            "message": "Abandoned\n\nImage import is already implemented.",
            "accounts_in_message": [],
            "_revision_number": 2
        }
    ],
    "requirements": [],
    "submit_records": []
}
{
    "id": "openstack%2Fglance~master~I475b22fdc2c8acb0e2af57e4a10fc81d7727721e",
    "project": "openstack/glance",
    "branch": "master",
    "topic": "bug/1028081",
    "hashtags": [],
    "change_id": "I475b22fdc2c8acb0e2af57e4a10fc81d7727721e",
    "subject": "Stop properties from being deleted when an image is deleted.",
    "status": "ABANDONED",
    "created": "2012-07-23 19:43:19.000000000",
    "updated": "2012-07-27 18:15:20.000000000",
    "insertions": 72,
    "deletions": 14,
    "total_comment_count": 0,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "e6856a090adf1501b72dd1e56e70b0e8e07dd0f7",
    "_number": 10160,
    "owner": {
        "_account_id": 177,
        "name": "Alex Meade",
        "email": "mr.alex.meade@gmail.com",
        "username": "alex-meade"
    },
    "labels": {
        "Verified": {
            "recommended": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "all": [
                {
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "_account_id": 927,
                    "name": "Gabe Westmaas",
                    "email": "gabe.westmaas@rackspace.com",
                    "username": "westmaas"
                },
                {
                    "_account_id": 1030,
                    "name": "Chris Behrens",
                    "email": "cbehrens@codestud.com",
                    "username": "cbehrens"
                },
                {
                    "_account_id": 177,
                    "name": "Alex Meade",
                    "email": "mr.alex.meade@gmail.com",
                    "username": "alex-meade"
                },
                {
                    "value": 1,
                    "date": "2012-07-27 14:44:13.000000000",
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "value": 1,
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "rejected": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "all": [
                {
                    "value": -2,
                    "date": "2012-07-27 14:19:10.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "value": 0,
                    "date": "2012-07-27 15:49:13.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 927,
                    "name": "Gabe Westmaas",
                    "email": "gabe.westmaas@rackspace.com",
                    "username": "westmaas"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 1030,
                    "name": "Chris Behrens",
                    "email": "cbehrens@codestud.com",
                    "username": "cbehrens"
                },
                {
                    "value": 0,
                    "date": "2012-07-27 17:43:40.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 177,
                    "name": "Alex Meade",
                    "email": "mr.alex.meade@gmail.com",
                    "username": "alex-meade"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "all": [
                {
                    "date": "2012-07-27 15:32:57.000000000",
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "_account_id": 927,
                    "name": "Gabe Westmaas",
                    "email": "gabe.westmaas@rackspace.com",
                    "username": "westmaas"
                },
                {
                    "_account_id": 1030,
                    "name": "Chris Behrens",
                    "email": "cbehrens@codestud.com",
                    "username": "cbehrens"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 0
                    },
                    "_account_id": 177,
                    "name": "Alex Meade",
                    "email": "mr.alex.meade@gmail.com",
                    "username": "alex-meade"
                },
                {
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "_account_id": 1132,
                    "name": "Brian Waldon",
                    "email": "brian@waldon.cc",
                    "username": "bcwaldon"
                },
                {
                    "_account_id": 927,
                    "name": "Gabe Westmaas",
                    "email": "gabe.westmaas@rackspace.com",
                    "username": "westmaas"
                },
                {
                    "_account_id": 1030,
                    "name": "Chris Behrens",
                    "email": "cbehrens@codestud.com",
                    "username": "cbehrens"
                },
                {
                    "_account_id": 177,
                    "name": "Alex Meade",
                    "email": "mr.alex.meade@gmail.com",
                    "username": "alex-meade"
                },
                {
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            {
                "_account_id": 1030,
                "name": "Chris Behrens",
                "email": "cbehrens@codestud.com",
                "username": "cbehrens"
            },
            {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2012-07-25 22:26:11.000000000",
            "updated_by": {
                "_account_id": 1030,
                "name": "Chris Behrens",
                "email": "cbehrens@codestud.com",
                "username": "cbehrens"
            },
            "reviewer": {
                "_account_id": 1030,
                "name": "Chris Behrens",
                "email": "cbehrens@codestud.com",
                "username": "cbehrens"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2012-07-27 14:44:13.000000000",
            "updated_by": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "reviewer": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2012-07-27 15:32:57.000000000",
            "updated_by": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "reviewer": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2012-07-27 15:49:13.000000000",
            "updated_by": {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            "reviewer": {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            "state": "REVIEWER"
        }
    ],
    "messages": [
        {
            "id": "0c63e195b0bd08fd2778a277945d3f6e2d7a7149",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2012-07-23 20:02:03.000000000",
            "message": "Patch Set 1: Doesn't seem to work\n\nBuild failed\n\n- https://jenkins.openstack.org/job/gate-glance-merge/1392/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-pep8/1513/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python26/1024/testReport : FAILURE\n- https://jenkins.openstack.org/job/gate-glance-python27/1024/testReport : FAILURE\n- https://jenkins.openstack.org/job/gate-tempest-devstack-vm/4502/testReport : SUCCESS\n",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "be55a8d15a8cb638f3ad5f715a5ef8d54028ae6d",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-23 20:46:28.000000000",
            "message": "Uploaded patch set 2.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "36b5c22c318f5eaf0a3040c4682bae1091b35b63",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-23 20:53:57.000000000",
            "message": "Uploaded patch set 3.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "3e2f286024fe462a277400fa86b41aca7081a5e9",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2012-07-23 21:10:29.000000000",
            "message": "Patch Set 3: Works for me\n\nBuild successful\n\n- https://jenkins.openstack.org/job/gate-glance-merge/1395/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-pep8/1516/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python26/1027/testReport : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python27/1027/testReport : SUCCESS\n- https://jenkins.openstack.org/job/gate-tempest-devstack-vm/4527/testReport : SUCCESS\n",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "c1c2c94122fda3a3510649ddbc0dd1385c9371d1",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-25 21:08:00.000000000",
            "message": "Uploaded patch set 4.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "f494028b8a0baaed0d7b8c3850cd543b75dac2ec",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2012-07-25 21:19:49.000000000",
            "message": "Patch Set 4: Works for me\n\nBuild successful\n\n- https://jenkins.openstack.org/job/gate-glance-merge/1420/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-pep8/1541/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python26/1052/testReport : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python27/1052/testReport : SUCCESS\n- https://jenkins.openstack.org/job/gate-tempest-devstack-vm/4816/testReport : SUCCESS\n",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "f545b175a5eabe5fd616703b29768d61e4dd26c3",
            "author": {
                "_account_id": 1030,
                "name": "Chris Behrens",
                "email": "cbehrens@codestud.com",
                "username": "cbehrens"
            },
            "real_author": {
                "_account_id": 1030,
                "name": "Chris Behrens",
                "email": "cbehrens@codestud.com",
                "username": "cbehrens"
            },
            "date": "2012-07-25 22:26:11.000000000",
            "message": "Patch Set 4: Looks good to me, but someone else must approve\n\n",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "ab6279e27ec5ad0bc733db785ae99fbfd2c56113",
            "author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "real_author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "date": "2012-07-26 23:51:17.000000000",
            "message": "Patch Set 4: Do not merge\n\nI don't buy this change. Why not allow internal clients of the db layer to see deleted properties when looking for a deleted image?\n\nAnd please keep arbitrary changes out of patches like this. You don't need to rename delete_image_metadata to delete_image.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "06c498a8b263d9a70c759dac99317aef3079b80f",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-27 14:03:52.000000000",
            "message": "Patch Set 4:\n\nHey Waldon,\n\n\"I don't buy this change. Why not allow internal clients of the db layer to see deleted properties when looking for a deleted image?\"\n\nWhat do you mean here exactly?\n\nI don't buy deleting image properties and members just because we are deleting the image. The properties and members are still describing the image, even if it is deleted. I think properties and members should only be marked deleted if they are deleted explicitly.\n\n\n\"And please keep arbitrary changes out of patches like this. You don't need to rename delete_image_metadata to delete_image.\"\n\nAh I see, I thought I did need to rename delete_image_metadata because I changed what it did but now I get it.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "18840ffb9e119a69359d167f50421b8ffa1a8267",
            "author": {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            "real_author": {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            "date": "2012-07-27 14:16:54.000000000",
            "message": "Patch Set 4: Looks good to me, but someone else must approve\n\nWaldon:\n\nIf you delete properties after the image is deleted, you can no longer tell the difference between properties deleted as part of the image deletion and properties deleted explicitly prior to deletion.\n\nThere's no extra space used by doing it this way (since we just mark as deleted), and as Alex says those properties still describe that image.\n\nIf operators want to reap properties from the db, its a slightly more complicated sql statement, but still a very reasonable ones (check if the image is deleted instead of just the properties).",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "78602da3bec42eb6d67cc7b63f75a2540953219a",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-27 14:19:10.000000000",
            "message": "Uploaded patch set 5.",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "4cdc35ec7898245e3dd444194ba216800864e0f3",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2012-07-27 14:44:13.000000000",
            "message": "Patch Set 5: Works for me\n\nBuild successful\n\n- https://jenkins.openstack.org/job/gate-glance-merge/1433/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-pep8/1554/consoleFull : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python26/1066/testReport : SUCCESS\n- https://jenkins.openstack.org/job/gate-glance-python27/1065/testReport : SUCCESS\n- https://jenkins.openstack.org/job/gate-tempest-devstack-vm/5099/testReport : SUCCESS\n",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "ef42b5810e2a2c97ee68c11f0400c76cc9dcee7d",
            "author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "real_author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "date": "2012-07-27 15:32:57.000000000",
            "message": "Patch Set 5:\n\nSo my biggest concern is the ever-growing database. My understanding is that 'deleted' rows could be dropped safely by a database administrator to prevent the database from growing too large. If we have an image with a billion properties and we delete that image (set deleted=True), then how will we know we can delete those billion properties?",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "4ef7a5067c9e25169712735deae97116edfb5583",
            "author": {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            "real_author": {
                "_account_id": 927,
                "name": "Gabe Westmaas",
                "email": "gabe.westmaas@rackspace.com",
                "username": "westmaas"
            },
            "date": "2012-07-27 15:49:13.000000000",
            "message": "Patch Set 5:\n\nWe can just delete all properties from glance.properties that have an image ID that either matches a row in images where it is deleted, or where there is no matching row in images (in the case where the admin has already deleted the image).  It is slightly more complicated SQL but nothing crazy.",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "662c1019571bcb7d9ec7b1854dd055803642a5f7",
            "author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "real_author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "date": "2012-07-27 15:56:30.000000000",
            "message": "Patch Set 5:\n\nBut then we're making the simple deleted=True convention mean less and deployers will have to know about this special case, right? We're just moving complexity. Why not keep the complexity in the code where it belongs?",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "91f1138d80679ab2e5004ed42be59ead9dbc711b",
            "author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "real_author": {
                "_account_id": 1132,
                "name": "Brian Waldon",
                "email": "brian@waldon.cc",
                "username": "bcwaldon"
            },
            "date": "2012-07-27 16:19:26.000000000",
            "message": "Patch Set 5:\n\nAnd this really feels like we're treating a symptom of the problem. Why are we trying to notify with an image that has been deleted? That image is gone as far as the calling code is concerned. This concept of setting deleted=True is also an implementation detail of the sqlalchemy driver. We shouldn't be depending on it like this.\n\nWe can either throw the notification as soon as the DELETE call is received, which might make sense from a billing perspective, or we could sure we have the image before we call db.api.image_destroy. Have you looked into either of those approaches?",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "4d5cb66706a40435303783cd02371ea655eb9210",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-27 17:43:40.000000000",
            "message": "Patch Set 5:\n\nThanks for the reviews so far. \n\nI'm gonna mp a simpler patch that just notifies with the image object that was gotten before the image is deleted. However this makes it so the payload has \"deleted=False\" which isn't true.\n\nIf setting deleted is an implementation detail then we should stop the db layer from returning the deleted attribute. \n\nhere's the MP\nhttps://review.openstack.org/#/c/10420/",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "f4d94b7413e4882cf868c5b16d4d9c330599b696",
            "author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "real_author": {
                "_account_id": 177,
                "name": "Alex Meade",
                "email": "mr.alex.meade@gmail.com",
                "username": "alex-meade"
            },
            "date": "2012-07-27 18:15:20.000000000",
            "message": "Patch Set 5: Abandoned\n\nalternate solution in other MP",
            "accounts_in_message": [],
            "_revision_number": 5
        }
    ],
    "requirements": [],
    "submit_records": []
}
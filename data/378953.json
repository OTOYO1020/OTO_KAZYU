{
    "id": "openstack%2Fglance~master~Iee2e91ff8fc7077cf2f2f61f1295c90c842d3fa9",
    "project": "openstack/glance",
    "branch": "master",
    "topic": "bug/1627147",
    "hashtags": [],
    "change_id": "Iee2e91ff8fc7077cf2f2f61f1295c90c842d3fa9",
    "subject": "v2: Read the X-Image-Meta-Size header when deserializing a request.",
    "status": "ABANDONED",
    "created": "2016-09-28 18:45:49.000000000",
    "updated": "2017-12-02 19:54:05.000000000",
    "insertions": 4,
    "deletions": 2,
    "total_comment_count": 0,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "30809e8ad683b9d31462df95e90cecf7458bc079",
    "_number": 378953,
    "owner": {
        "_account_id": 8122,
        "name": "Cyril Roelandt",
        "email": "cyril@redhat.com",
        "username": "cyril.roelandt.enovance"
    },
    "labels": {
        "Verified": {
            "disliked": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "all": [
                {
                    "date": "2016-09-29 15:30:44.000000000",
                    "_account_id": 8122,
                    "name": "Cyril Roelandt",
                    "email": "cyril@redhat.com",
                    "username": "cyril.roelandt.enovance"
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "_account_id": 12000,
                    "name": "Ian Cordasco",
                    "email": "sigmavirus24@gmail.com",
                    "username": "sigmavirus24"
                },
                {
                    "value": -1,
                    "date": "2017-03-29 15:21:13.000000000",
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "value": -1,
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "disliked": {
                "_account_id": 12000,
                "name": "Ian Cordasco",
                "email": "sigmavirus24@gmail.com",
                "username": "sigmavirus24"
            },
            "all": [
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -2,
                        "max": 2
                    },
                    "_account_id": 8122,
                    "name": "Cyril Roelandt",
                    "email": "cyril@redhat.com",
                    "username": "cyril.roelandt.enovance"
                },
                {
                    "value": -1,
                    "date": "2016-09-29 09:18:55.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": -1,
                    "date": "2017-01-24 17:05:52.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 12000,
                    "name": "Ian Cordasco",
                    "email": "sigmavirus24@gmail.com",
                    "username": "sigmavirus24"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "value": -1,
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "all": [
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 8122,
                    "name": "Cyril Roelandt",
                    "email": "cyril@redhat.com",
                    "username": "cyril.roelandt.enovance"
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "_account_id": 12000,
                    "name": "Ian Cordasco",
                    "email": "sigmavirus24@gmail.com",
                    "username": "sigmavirus24"
                },
                {
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 2
                    },
                    "_account_id": 8122,
                    "name": "Cyril Roelandt",
                    "email": "cyril@redhat.com",
                    "username": "cyril.roelandt.enovance"
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "_account_id": 12000,
                    "name": "Ian Cordasco",
                    "email": "sigmavirus24@gmail.com",
                    "username": "sigmavirus24"
                },
                {
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            {
                "_account_id": 8122,
                "name": "Cyril Roelandt",
                "email": "cyril@redhat.com",
                "username": "cyril.roelandt.enovance"
            },
            {
                "_account_id": 12000,
                "name": "Ian Cordasco",
                "email": "sigmavirus24@gmail.com",
                "username": "sigmavirus24"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2016-09-29 09:18:55.000000000",
            "updated_by": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "reviewer": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2017-01-24 17:05:52.000000000",
            "updated_by": {
                "_account_id": 12000,
                "name": "Ian Cordasco",
                "email": "sigmavirus24@gmail.com",
                "username": "sigmavirus24"
            },
            "reviewer": {
                "_account_id": 12000,
                "name": "Ian Cordasco",
                "email": "sigmavirus24@gmail.com",
                "username": "sigmavirus24"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2017-03-29 15:21:13.000000000",
            "updated_by": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "reviewer": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "state": "REVIEWER"
        }
    ],
    "messages": [
        {
            "id": "8f8b5fe3febf68660ff5bb062ddf842c4549a11d",
            "author": {
                "_account_id": 8122,
                "name": "Cyril Roelandt",
                "email": "cyril@redhat.com",
                "username": "cyril.roelandt.enovance"
            },
            "real_author": {
                "_account_id": 8122,
                "name": "Cyril Roelandt",
                "email": "cyril@redhat.com",
                "username": "cyril.roelandt.enovance"
            },
            "date": "2016-09-28 18:45:49.000000000",
            "message": "Uploaded patch set 1.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "5836631ec0d7a9ae1356f19208f335832375774e",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2016-09-28 22:40:01.000000000",
            "message": "Patch Set 1: Verified+1\n\nBuild succeeded (check pipeline).\n\n- gate-glance-python34-db http://logs.openstack.org/53/378953/1/check/gate-glance-python34-db/e369c46/ : SUCCESS in 4m 02s\n- gate-glance-python35-db-nv http://logs.openstack.org/53/378953/1/check/gate-glance-python35-db-nv/9a55665/ : FAILURE in 48m 28s (non-voting)\n- gate-glance-docs-ubuntu-xenial http://docs-draft.openstack.org/53/378953/1/check/gate-glance-docs-ubuntu-xenial/b4063a5//doc/build/html/ : SUCCESS in 8m 52s\n- gate-glance-pep8-ubuntu-xenial http://logs.openstack.org/53/378953/1/check/gate-glance-pep8-ubuntu-xenial/de2fb0f/ : SUCCESS in 3m 23s\n- gate-glance-python27-db-ubuntu-xenial http://logs.openstack.org/53/378953/1/check/gate-glance-python27-db-ubuntu-xenial/35cf051/ : SUCCESS in 9m 47s\n- gate-tempest-dsvm-neutron-full-ubuntu-xenial http://logs.openstack.org/53/378953/1/check/gate-tempest-dsvm-neutron-full-ubuntu-xenial/92cc6b0/ : SUCCESS in 1h 08m 40s\n- gate-grenade-dsvm-neutron-ubuntu-xenial http://logs.openstack.org/53/378953/1/check/gate-grenade-dsvm-neutron-ubuntu-xenial/588f403/ : SUCCESS in 32m 37s\n- gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial http://logs.openstack.org/53/378953/1/check/gate-tempest-dsvm-full-devstack-plugin-ceph-ubuntu-xenial/333732b/ : SUCCESS in 41m 40s\n- gate-tempest-dsvm-neutron-identity-v3-only-full-ubuntu-xenial-nv http://logs.openstack.org/53/378953/1/check/gate-tempest-dsvm-neutron-identity-v3-only-full-ubuntu-xenial-nv/c178edc/ : SUCCESS in 49m 39s (non-voting)\n- gate-rally-dsvm-glance http://logs.openstack.org/53/378953/1/check/gate-rally-dsvm-glance/bdfae63/ : SUCCESS in 27m 01s (non-voting)",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "042ae01305e416bd91dffb2cc47d0f37eec0334a",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-09-29 09:18:55.000000000",
            "message": "Patch Set 1: Code-Review-1\n\nThis seems to be a fundamental V2 API change masquerading as a bug fix?",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "9e57a5290759c2587060284a49781948533f8aa8",
            "author": {
                "_account_id": 8122,
                "name": "Cyril Roelandt",
                "email": "cyril@redhat.com",
                "username": "cyril.roelandt.enovance"
            },
            "real_author": {
                "_account_id": 8122,
                "name": "Cyril Roelandt",
                "email": "cyril@redhat.com",
                "username": "cyril.roelandt.enovance"
            },
            "date": "2016-09-29 15:30:44.000000000",
            "message": "Patch Set 1:\n\n@Stuart: this is actually a bug fix, please read my (long) comment on the bug report. We need to know the full size of the image to fix this bug, but cannot seem to pass it using the \"Content-Length\" header.\n\nI'm obviously open to suggestions on how to do this in a cleaner way :)",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "88d4a23fa90626f135ad1dad52cfec603d1a78c4",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-09-29 16:59:42.000000000",
            "message": "Patch Set 1:\n\nHi Cyril,\n\nSure. I guess I just meant to say that we really need to think if we can avoid having to change the v2 API to add a v1-style header to fix the issue.\n\nAs far as I remember, one of the main reasons for introducing the v2 API was to switch from using headers for metadata to using json in the body for meta data. So this feels a bit as if it goes against that design principle.\n\nI'm a bit short on cycles to come up with alternatives right now (sorry!).",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "15deb9cfe3a019cad90ed68c3a9f7bc89069ac6a",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-09-29 17:03:58.000000000",
            "message": "Patch Set 1:\n\nMaybe we could set the size in json when we first create the image (POST)?",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "569290fec9ca1e10cd1aea3850249c264fede497",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-09-30 09:25:21.000000000",
            "message": "Patch Set 1:\n\nThinking about this a bit more...\n\nFrom the client point of view there are two cases:\n\n1. The client knows the image size before hand (eg the image is /tmp/image.qcow2)\n\n2. The client doesn't know the image size before hand (eg the image is being created by a process and piped into the client)\n\n\nIt should be possible to do something as follows (Didn't we do this in the v1 client?)\n\n\nFor case (1):\n\nThe client can set the Content-Length header, and does not need to use the Transfer-Encoding header.\n\nFor case (2):\n\nThe client doesn't know the size, so can use the Transfer-Encoding header and not set the Content-Length header.\n\nIf we made that change we should add *comprehensive* client and server side tests.\n\n\nWe would need to add tests to check the equivalent of:\n\n\n1) Piped input (style 1)\n\ndd if=/dev/random bs=1048576 count=1 | glance ...\n\n2) Piped input (style 2)\n\ncat /etc/fstab | glance ...\n\n3) fifo\n\n[terminal 1] mkfifo /tmp/fifo\n[terminal 2] glance ... < /tmp/fifo\n[terminal 1] echo hi > /tmp/fifo\n\n4) file\n\nglance ... --file /tmp/image.qcow2",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "a9fe44cd2dde05ef5104d40dc7fc63db8c3f9fee",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2016-09-30 10:20:13.000000000",
            "message": "Patch Set 1:\n\n5) --file where the file is a fifo ?",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "9cd893bb0b97218f35af0e5d0b9d69a065c7a4ba",
            "author": {
                "_account_id": 12000,
                "name": "Ian Cordasco",
                "email": "sigmavirus24@gmail.com",
                "username": "sigmavirus24"
            },
            "real_author": {
                "_account_id": 12000,
                "name": "Ian Cordasco",
                "email": "sigmavirus24@gmail.com",
                "username": "sigmavirus24"
            },
            "date": "2017-01-24 17:05:52.000000000",
            "message": "Patch Set 1: Code-Review-1\n\nI have to agree with Stuart. Using a v1 style header when those are explicitly forbidden for new APIs by the API-WG is a bad idea, especially when part of the reason for v2 was to move away from those very headers.\n\nSecond, I think that Stuart's on the right path with sending this with the initial POST. I understand that doesn't always work, but that's the best bet IMO",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "ce07f9c349be49eb5e54d6b760f787468efa35a2",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2017-03-29 15:21:13.000000000",
            "message": "Patch Set 1: Verified-1\n\nMerge Failed.\n\nThis change or one of its cross-repo dependencies was unable to be automatically merged with the current state of its repository. Please rebase the change and upload a new patchset.",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "04f8098be84e9eb2574c5fc50b5a50f4091210c8",
            "author": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "real_author": {
                "_account_id": 5314,
                "name": "Brian Rosmaita",
                "email": "rosmaita.fossdev@gmail.com",
                "username": "brian-rosmaita"
            },
            "date": "2017-12-02 19:54:05.000000000",
            "message": "Abandoned\n\nAbandoning due to lack of activity.  Bug has been updated.",
            "accounts_in_message": [],
            "_revision_number": 1
        }
    ],
    "requirements": [],
    "submit_records": []
}
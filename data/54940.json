{
    "id": "openstack%2Fglance~master~I509af8de107dc2859d2276a86e3779c3f9e761ac",
    "project": "openstack/glance",
    "branch": "master",
    "topic": "bug/1247144",
    "hashtags": [],
    "change_id": "I509af8de107dc2859d2276a86e3779c3f9e761ac",
    "subject": "Make image cache reads cooperative",
    "status": "ABANDONED",
    "created": "2013-11-01 15:36:42.000000000",
    "updated": "2013-12-05 13:18:42.000000000",
    "insertions": 2,
    "deletions": 0,
    "total_comment_count": 16,
    "unresolved_comment_count": 0,
    "has_review_started": true,
    "meta_rev_id": "d37159fc6ae6ed4850757fab3800d0cd63417b16",
    "_number": 54940,
    "owner": {
        "_account_id": 6737,
        "name": "Edward Hope-Morley",
        "email": "edward.hope-morley@canonical.com",
        "username": "hopem"
    },
    "labels": {
        "Verified": {
            "recommended": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "all": [
                {
                    "_account_id": 7884,
                    "name": "Noboru Arai",
                    "email": "arai@mxa.nes.nec.co.jp",
                    "username": "NoboruArai"
                },
                {
                    "_account_id": 6549,
                    "name": "Zhi Yan Liu",
                    "email": "lzy.dev@gmail.com",
                    "username": "lzy-dev"
                },
                {
                    "_account_id": 2166,
                    "name": "SmokeStack CI",
                    "username": "smokestack",
                    "tags": [
                        "SERVICE_USER"
                    ]
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "_account_id": 6737,
                    "name": "Edward Hope-Morley",
                    "email": "edward.hope-morley@canonical.com",
                    "username": "hopem"
                },
                {
                    "value": 1,
                    "date": "2013-11-29 17:56:52.000000000",
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Fails",
                "-1": "Doesn't seem to work",
                " 0": "No score",
                "+1": "Works for me",
                "+2": "Verified"
            },
            "description": "",
            "value": 1,
            "default_value": 0,
            "optional": true
        },
        "Code-Review": {
            "disliked": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "all": [
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 7884,
                    "name": "Noboru Arai",
                    "email": "arai@mxa.nes.nec.co.jp",
                    "username": "NoboruArai"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 6549,
                    "name": "Zhi Yan Liu",
                    "email": "lzy.dev@gmail.com",
                    "username": "lzy-dev"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 2166,
                    "name": "SmokeStack CI",
                    "username": "smokestack",
                    "tags": [
                        "SERVICE_USER"
                    ]
                },
                {
                    "value": -1,
                    "date": "2013-12-05 13:03:57.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "date": "2013-11-29 14:31:24.000000000",
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 6737,
                    "name": "Edward Hope-Morley",
                    "email": "edward.hope-morley@canonical.com",
                    "username": "hopem"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 1
                    },
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-2": "Do not merge",
                "-1": "This patch needs further work before it can be merged",
                " 0": "No score",
                "+1": "Looks good to me, but someone else must approve",
                "+2": "Looks good to me (core reviewer)"
            },
            "description": "",
            "value": -1,
            "default_value": 0,
            "optional": true
        },
        "Workflow": {
            "all": [
                {
                    "_account_id": 7884,
                    "name": "Noboru Arai",
                    "email": "arai@mxa.nes.nec.co.jp",
                    "username": "NoboruArai"
                },
                {
                    "_account_id": 6549,
                    "name": "Zhi Yan Liu",
                    "email": "lzy.dev@gmail.com",
                    "username": "lzy-dev"
                },
                {
                    "_account_id": 2166,
                    "name": "SmokeStack CI",
                    "username": "smokestack",
                    "tags": [
                        "SERVICE_USER"
                    ]
                },
                {
                    "date": "2013-12-03 18:03:49.000000000",
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "value": 0,
                    "permitted_voting_range": {
                        "min": -1,
                        "max": 0
                    },
                    "_account_id": 6737,
                    "name": "Edward Hope-Morley",
                    "email": "edward.hope-morley@canonical.com",
                    "username": "hopem"
                },
                {
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Work in progress",
                " 0": "Ready for reviews",
                "+1": "Approved"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        },
        "Review-Priority": {
            "all": [
                {
                    "_account_id": 7884,
                    "name": "Noboru Arai",
                    "email": "arai@mxa.nes.nec.co.jp",
                    "username": "NoboruArai"
                },
                {
                    "_account_id": 6549,
                    "name": "Zhi Yan Liu",
                    "email": "lzy.dev@gmail.com",
                    "username": "lzy-dev"
                },
                {
                    "_account_id": 2166,
                    "name": "SmokeStack CI",
                    "username": "smokestack",
                    "tags": [
                        "SERVICE_USER"
                    ]
                },
                {
                    "_account_id": 455,
                    "name": "Stuart McLaren",
                    "email": "stuart.mclaren@hpe.com",
                    "username": "stuart-mclaren"
                },
                {
                    "_account_id": 6737,
                    "name": "Edward Hope-Morley",
                    "email": "edward.hope-morley@canonical.com",
                    "username": "hopem"
                },
                {
                    "_account_id": 3,
                    "name": "Jenkins",
                    "username": "jenkins"
                }
            ],
            "values": {
                "-1": "Branch Freeze",
                " 0": "No Priority",
                "+1": "Important Change",
                "+2": "Top Priority / Holds Gate"
            },
            "description": "",
            "default_value": 0,
            "optional": true
        }
    },
    "removable_reviewers": [],
    "reviewers": {
        "REVIEWER": [
            {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            {
                "_account_id": 7884,
                "name": "Noboru Arai",
                "email": "arai@mxa.nes.nec.co.jp",
                "username": "NoboruArai"
            }
        ]
    },
    "pending_reviewers": {},
    "reviewer_updates": [
        {
            "updated": "2013-11-13 17:18:50.000000000",
            "updated_by": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "reviewer": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-11-14 02:54:16.000000000",
            "updated_by": {
                "_account_id": 7884,
                "name": "Noboru Arai",
                "email": "arai@mxa.nes.nec.co.jp",
                "username": "NoboruArai"
            },
            "reviewer": {
                "_account_id": 7884,
                "name": "Noboru Arai",
                "email": "arai@mxa.nes.nec.co.jp",
                "username": "NoboruArai"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-11-29 04:47:17.000000000",
            "updated_by": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "reviewer": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-11-29 17:56:52.000000000",
            "updated_by": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "reviewer": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "state": "REVIEWER"
        },
        {
            "updated": "2013-12-03 18:03:49.000000000",
            "updated_by": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "reviewer": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "state": "REVIEWER"
        }
    ],
    "messages": [
        {
            "id": "e52d042a246730c5f1ebcd8b1a8fca32625f8f6d",
            "author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "real_author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "date": "2013-11-01 15:56:53.000000000",
            "message": "Patch Set 1: Works for me\n\nSmokeStack Results (patch set 1):\n- Libvirt (Fedora 19) https://smokestack.openstack.org/?go=/jobs/153264 : SUCCESS \n- Libvirt (Centos 6.4) https://smokestack.openstack.org/?go=/jobs/153265 : SUCCESS \n",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "4f2f63557520d7a9a745207c6e7c7db769d8b4c7",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-11-01 16:08:11.000000000",
            "message": "Patch Set 1: Doesn't seem to work\n\nBuild failed.  For information on how to proceed, see https://wiki.openstack.org/wiki/GerritJenkinsGit#Test_Failures\n\n- gate-glance-pep8 http://logs.openstack.org/40/54940/1/check/gate-glance-pep8/34163c0 : SUCCESS in 1m 16s\n- gate-glance-docs http://docs-draft.openstack.org/40/54940/1/check/gate-glance-docs/fc17c6f/doc/build/html/ : SUCCESS in 1m 14s\n- gate-glance-python26 http://logs.openstack.org/40/54940/1/check/gate-glance-python26/1d78fcc : SUCCESS in 12m 54s\n- gate-glance-python27 http://logs.openstack.org/40/54940/1/check/gate-glance-python27/84ba738 : SUCCESS in 10m 26s\n- check-tempest-devstack-vm-full http://logs.openstack.org/40/54940/1/check/check-tempest-devstack-vm-full/fca2678 : FAILURE in 30m 17s\n- check-tempest-devstack-vm-postgres-full http://logs.openstack.org/40/54940/1/check/check-tempest-devstack-vm-postgres-full/a55ddd9 : SUCCESS in 31m 23s\n- check-tempest-devstack-vm-neutron http://logs.openstack.org/40/54940/1/check/check-tempest-devstack-vm-neutron/17ab015 : SUCCESS in 18m 37s\n- gate-tempest-devstack-vm-large-ops http://logs.openstack.org/40/54940/1/check/gate-tempest-devstack-vm-large-ops/b748d0c : SUCCESS in 13m 49s\n- gate-tempest-devstack-vm-neutron-large-ops http://logs.openstack.org/40/54940/1/check/gate-tempest-devstack-vm-neutron-large-ops/57284a3 : FAILURE in 20m 37s (non-voting)\n- check-grenade-devstack-vm http://logs.openstack.org/40/54940/1/check/check-grenade-devstack-vm/aaa9299 : SUCCESS in 28m 46s\n",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "0fca7032771706f5d9ff257355d80109565d08b9",
            "author": {
                "_account_id": 8871,
                "name": "Elastic Recheck",
                "username": "elasticrecheck"
            },
            "real_author": {
                "_account_id": 8871,
                "name": "Elastic Recheck",
                "username": "elasticrecheck"
            },
            "date": "2013-11-01 16:08:23.000000000",
            "message": "Patch Set 1:\n\nI noticed tempest failed, I think you hit bug(s): https://bugs.launchpad.net/bugs/1240256",
            "accounts_in_message": [],
            "_revision_number": 1
        },
        {
            "id": "2f4050fda84e290808c91d7d346b172827219ddf",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-01 16:36:41.000000000",
            "message": "Uploaded patch set 2.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "5fc768da09c46b9de7b316670b22062a1def87aa",
            "author": {
                "_account_id": 5494,
                "name": "Trivial Rebase",
                "email": "trivial-rebase@review.openstack.org",
                "username": "trivial-rebase"
            },
            "real_author": {
                "_account_id": 5494,
                "name": "Trivial Rebase",
                "email": "trivial-rebase@review.openstack.org",
                "username": "trivial-rebase"
            },
            "date": "2013-11-01 16:36:49.000000000",
            "message": "Patch Set 2:\n\nNew patchset patch-id matches previous patchset, but commit message has changed.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "1674ccb9ff0e3562533d0cde703d82682314c40b",
            "author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "real_author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "date": "2013-11-01 17:00:29.000000000",
            "message": "Patch Set 2: Works for me\n\nSmokeStack Results (patch set 2):\n- Libvirt (Fedora 19) https://smokestack.openstack.org/?go=/jobs/153285 : SUCCESS \n- Libvirt (Centos 6.4) https://smokestack.openstack.org/?go=/jobs/153286 : SUCCESS \n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "4a9fc9dfc86d04bfcdfef3e16fe4b1f2598d4fc7",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-11-01 17:08:59.000000000",
            "message": "Patch Set 2: Works for me\n\nBuild succeeded.\n\n- gate-glance-pep8 http://logs.openstack.org/40/54940/2/check/gate-glance-pep8/210ce8d : SUCCESS in 1m 54s\n- gate-glance-docs http://docs-draft.openstack.org/40/54940/2/check/gate-glance-docs/8beccbf/doc/build/html/ : SUCCESS in 2m 00s\n- gate-glance-python26 http://logs.openstack.org/40/54940/2/check/gate-glance-python26/b28acca : SUCCESS in 14m 25s\n- gate-glance-python27 http://logs.openstack.org/40/54940/2/check/gate-glance-python27/76f70f2 : SUCCESS in 9m 35s\n- check-tempest-devstack-vm-full http://logs.openstack.org/40/54940/2/check/check-tempest-devstack-vm-full/7a34c03 : SUCCESS in 32m 12s\n- check-tempest-devstack-vm-postgres-full http://logs.openstack.org/40/54940/2/check/check-tempest-devstack-vm-postgres-full/0d8364a : SUCCESS in 31m 09s\n- check-tempest-devstack-vm-neutron http://logs.openstack.org/40/54940/2/check/check-tempest-devstack-vm-neutron/b87cc3a : SUCCESS in 17m 44s\n- gate-tempest-devstack-vm-large-ops http://logs.openstack.org/40/54940/2/check/gate-tempest-devstack-vm-large-ops/bd9d586 : SUCCESS in 13m 38s\n- gate-tempest-devstack-vm-neutron-large-ops http://logs.openstack.org/40/54940/2/check/gate-tempest-devstack-vm-neutron-large-ops/5176104 : FAILURE in 19m 10s (non-voting)\n- check-grenade-devstack-vm http://logs.openstack.org/40/54940/2/check/check-grenade-devstack-vm/5bd3b95 : SUCCESS in 28m 00s\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "82743e984fc4324bc4b0ba719c7402ef9556a447",
            "author": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "real_author": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "date": "2013-11-02 02:42:22.000000000",
            "message": "Patch Set 2: Looks good to me (core reviewer)\n\n",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "76fa6015e1047492f130001a8889fc873cc53efc",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-11-13 12:37:59.000000000",
            "message": "Patch Set 2: I would prefer that you didn't merge this\n\nHey Ed,\n\nI've done some previous work in this area before, see:\n\nhttps://review.openstack.org/#/c/9330/\nhttps://bugs.launchpad.net/glance/+bug/1021002\nhttps://bugs.launchpad.net/glance/+bug/1021002/+attachment/3213304/+files/yield.png\n\nI think what is probably required here is to re-use the same cooperative_iter which is used for v1 for the v2 code path. \n\nThis will improve both uploads and downloads and also downloads where the cache is not being used.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "d1cf158b9edb0ac6a3b9aaa5ac3b43df790c9d2c",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-13 16:03:55.000000000",
            "message": "Uploaded patch set 3.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "c83cf47f2fab3f0f477f225680c4cd3e434113be",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-13 16:06:30.000000000",
            "message": "Patch Set 2:\n\nStuart, I have amended the implementation here so take a look and see if it fits what you were after.",
            "accounts_in_message": [],
            "_revision_number": 2
        },
        {
            "id": "fc84d6f61ac2777bec156905c67ff81995409017",
            "author": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "real_author": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "date": "2013-11-13 16:23:54.000000000",
            "message": "Patch Set 3: (3 inline comments)\n\nGood point Stuart. And I have a minor suggestion.",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "29a941c71aab1b8a508288b3fdc7f59d44246c89",
            "author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "real_author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "date": "2013-11-13 16:28:27.000000000",
            "message": "Patch Set 3: Works for me\n\nSmokeStack Results (patch set 3):\n- Libvirt (Fedora 19) https://smokestack.openstack.org/?go=/jobs/156848 : SUCCESS \n- Libvirt (Centos 6.4) https://smokestack.openstack.org/?go=/jobs/156849 : SUCCESS \n",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "aa8c7e4b746a71b474c642fcae07b3f2c149988f",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-11-13 16:32:52.000000000",
            "message": "Patch Set 3: (1 inline comment)\n\n",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "238499d06d9fe679ec7161ff94b04451d31968ee",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-13 16:36:20.000000000",
            "message": "Patch Set 3: (3 inline comments)\n\n",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "6d821742e063ebd98061297bd3331cbb2cec4a1a",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-11-13 16:50:49.000000000",
            "message": "Patch Set 3: I would prefer that you didn't merge this\n\n(1 inline comment)\n\n",
            "accounts_in_message": [],
            "_revision_number": 3
        },
        {
            "id": "cc668190e0777355ce50861c3d9340f4aa844fd1",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-13 16:54:36.000000000",
            "message": "Uploaded patch set 4.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "a638f2144d167d1b66ae8c6df42e0d687ab4c300",
            "author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "real_author": {
                "_account_id": 2166,
                "name": "SmokeStack CI",
                "username": "smokestack",
                "tags": [
                    "SERVICE_USER"
                ]
            },
            "date": "2013-11-13 17:18:50.000000000",
            "message": "Patch Set 4: Works for me\n\nSmokeStack Results (patch set 4):\n- Libvirt (Fedora 19) https://smokestack.openstack.org/?go=/jobs/156860 : SUCCESS \n- Libvirt (Centos 6.4) https://smokestack.openstack.org/?go=/jobs/156861 : SUCCESS \n",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "1ccbdfc680dcfce2c14eefa741facef56471f0d8",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-11-13 17:37:39.000000000",
            "message": "Patch Set 4: Works for me\n\nBuild succeeded.\n\n- gate-glance-pep8 http://logs.openstack.org/40/54940/4/check/gate-glance-pep8/fdd9ca1 : SUCCESS in 1m 19s\n- gate-glance-docs http://docs-draft.openstack.org/40/54940/4/check/gate-glance-docs/83a6726/doc/build/html/ : SUCCESS in 1m 48s\n- gate-glance-python26 http://logs.openstack.org/40/54940/4/check/gate-glance-python26/011a9e9 : SUCCESS in 14m 21s\n- gate-glance-python27 http://logs.openstack.org/40/54940/4/check/gate-glance-python27/2b96744 : SUCCESS in 9m 32s\n- check-tempest-devstack-vm-full http://logs.openstack.org/40/54940/4/check/check-tempest-devstack-vm-full/16578d1 : SUCCESS in 31m 45s\n- check-tempest-devstack-vm-postgres-full http://logs.openstack.org/40/54940/4/check/check-tempest-devstack-vm-postgres-full/45f5378 : SUCCESS in 42m 51s\n- check-tempest-devstack-vm-neutron http://logs.openstack.org/40/54940/4/check/check-tempest-devstack-vm-neutron/b1093b7 : SUCCESS in 30m 23s\n- gate-tempest-devstack-vm-large-ops http://logs.openstack.org/40/54940/4/check/gate-tempest-devstack-vm-large-ops/07e0ed9 : SUCCESS in 14m 19s\n- gate-tempest-devstack-vm-neutron-large-ops http://logs.openstack.org/40/54940/4/check/gate-tempest-devstack-vm-neutron-large-ops/8a366a4 : FAILURE in 20m 25s (non-voting)\n- check-grenade-devstack-vm http://logs.openstack.org/40/54940/4/check/check-grenade-devstack-vm/c0eaee6 : SUCCESS in 34m 11s\n",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "2f91550fd38e7c00e3f515ec30edc81bd2f82ae5",
            "author": {
                "_account_id": 7884,
                "name": "Noboru Arai",
                "email": "arai@mxa.nes.nec.co.jp",
                "username": "NoboruArai"
            },
            "real_author": {
                "_account_id": 7884,
                "name": "Noboru Arai",
                "email": "arai@mxa.nes.nec.co.jp",
                "username": "NoboruArai"
            },
            "date": "2013-11-14 02:54:16.000000000",
            "message": "Patch Set 4: I would prefer that you didn't merge this\n\n(1 inline comment)\n\n",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "d92a59619c51257db007d0257eedfbea4dbf6c0d",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-14 14:01:01.000000000",
            "message": "Patch Set 4: (1 inline comment)\n\n",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "7f0714baf41cfcbd9f16e9e2fa951ba0fc0f1c55",
            "author": {
                "_account_id": 9,
                "name": "LaunchpadSync",
                "username": "launchpadsync"
            },
            "real_author": {
                "_account_id": 9,
                "name": "LaunchpadSync",
                "username": "launchpadsync"
            },
            "date": "2013-11-22 06:03:09.000000000",
            "message": "Patch Set 4:\n\ncode review expired after 1 week of no activity after a negative review, it can be restored using the `Restore Change` button under the Patch Set on the web interface",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "ae315f3998047e9a76a701fe7dfdbc2f81373655",
            "author": {
                "_account_id": 9,
                "name": "LaunchpadSync",
                "username": "launchpadsync"
            },
            "real_author": {
                "_account_id": 9,
                "name": "LaunchpadSync",
                "username": "launchpadsync"
            },
            "date": "2013-11-22 06:03:09.000000000",
            "message": "Patch Set 4: Abandoned\n\ncode review expired after 1 week of no activity after a negative review, it can be restored using the `Restore Change` button under the Patch Set on the web interface",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "9527b833cfa9b84fdf334486998d4ce1b9d2cf2f",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-28 18:28:29.000000000",
            "message": "Patch Set 4: Restored\n\nfurther analysis and testing has now proven that cache reads and writes are not cooperative and that adding in yields balances out image download from cache.",
            "accounts_in_message": [],
            "_revision_number": 4
        },
        {
            "id": "54766149c61ca3af94c9069e0419fac8d978b0f0",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-28 18:28:45.000000000",
            "message": "Uploaded patch set 5.",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "8326b7df67f7fc50a65a83ff3cff7123ab60b66e",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-11-28 19:13:48.000000000",
            "message": "Patch Set 5: Works for me\n\nBuild succeeded.\n\n- gate-glance-pep8 http://logs.openstack.org/40/54940/5/check/gate-glance-pep8/9d08821 : SUCCESS in 2m 18s\n- gate-glance-docs http://docs-draft.openstack.org/40/54940/5/check/gate-glance-docs/2991e2a/doc/build/html/ : SUCCESS in 1m 52s\n- gate-glance-python26 http://logs.openstack.org/40/54940/5/check/gate-glance-python26/5a24c77 : SUCCESS in 15m 18s\n- gate-glance-python27 http://logs.openstack.org/40/54940/5/check/gate-glance-python27/2dd2989 : SUCCESS in 12m 35s\n- check-tempest-devstack-vm-full http://logs.openstack.org/40/54940/5/check/check-tempest-devstack-vm-full/948500d : SUCCESS in 44m 28s\n- check-tempest-devstack-vm-postgres-full http://logs.openstack.org/40/54940/5/check/check-tempest-devstack-vm-postgres-full/0f910d4 : SUCCESS in 44m 53s\n- check-tempest-devstack-vm-neutron http://logs.openstack.org/40/54940/5/check/check-tempest-devstack-vm-neutron/1532c36 : SUCCESS in 25m 35s\n- gate-tempest-devstack-vm-large-ops http://logs.openstack.org/40/54940/5/check/gate-tempest-devstack-vm-large-ops/2dbaf91 : SUCCESS in 13m 06s\n- gate-tempest-devstack-vm-neutron-large-ops http://logs.openstack.org/40/54940/5/check/gate-tempest-devstack-vm-neutron-large-ops/b8bff00 : SUCCESS in 15m 04s\n- check-grenade-devstack-vm http://logs.openstack.org/40/54940/5/check/check-grenade-devstack-vm/17fa7d3 : SUCCESS in 31m 47s\n",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "6a299d661bd3cfbabdadea7411165a2ec9b9447a",
            "author": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "real_author": {
                "_account_id": 6549,
                "name": "Zhi Yan Liu",
                "email": "lzy.dev@gmail.com",
                "username": "lzy-dev"
            },
            "date": "2013-11-29 04:47:17.000000000",
            "message": "Patch Set 5: Looks good to me (core reviewer)\n\n",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "2b4663d8fe3b5de51a0450d55323aef1b1389043",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-11-29 11:06:18.000000000",
            "message": "Patch Set 5: I would prefer that you didn't merge this\n\n(2 inline comments)\n\nHi Ed,\n\nThanks for the updated patch.\n\nCan you post some details on your testing? It would help me understand what you are seeing and how the patch addresses it.\n\nWhat version of the api were you using? What backed store were you using? What size images were you using? How many concurrent threads were active? What were the results w.r.t scheduling fairness before and after this code change?\n\nWere you using v2? If so could you switch to using v1 and retry the downloads which tee into cache (before and after applying the patch) and let me know how that behaves? I suspect that since the v1 downloads are already wrapped in a cooperative_reader the patch won't affect the results in that case, but it would be great to get the data. If wrapping the downloaded object (ie current v1 approach) works then rather than patching at the point where we tee into cache we should patch the v2 download iter in the same way as v1 -- which will work whether cache is enabled or not. Thanks!\n\nMarking as '-1' mainly for the suspected duplicate wrapping in cooperative_iter in the v1 download case, and possibly to take the same approach for v2. (Based on more details of testing.)",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "6a45efdf6d84f9d37dd3b465e00450b2f65c5397",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 12:48:11.000000000",
            "message": "Patch Set 5: (2 inline comments)\n\n",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "a7ad020044e3b84cd49f21a4c9d209e4d2da3f30",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-11-29 12:57:40.000000000",
            "message": "Patch Set 5: (1 inline comment)\n\n",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "02a1d1242c2dfa0e8ef23416e44a89ebd7f25d1f",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 13:11:47.000000000",
            "message": "Patch Set 5: (1 inline comment)\n\n",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "f0596debff0fe3598c701615c83a892658beda9b",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 13:16:23.000000000",
            "message": "Patch Set 5:\n\nStuart,\n\nSo, I performed a fairly crude test but it did clearly demonstrate that (a) the reads were not yielding on each chunk read and (b) adding in the read yield results in evenly balanced reads. Running the following script from a couple of client nodes with before and after code, you get to see the effect:\n\n#!/bin/bash -eu\nIMG_ID=$1\nexport OS_IMAGE_API_VERSION=1\n# Do some concurrent downloads\nfor i in {0..8}\ndo\n    echo $i\n    glance image-download $IMG_ID > img.$i &\ndone\nwatch -n 0.5 ls -alF\n\nWhat I see with the new code is that the downloads all happened at about the same rate. Without the patch they are fairly random. I ran this test with the V1 and V2 api. For V1 I see a significant improvement whereas V2 I only see a slight improvement. I also tested that neither api's were using cooperative iterators by adding a log to iterator and watching for it.\n\nAs you pointed out the cache tee is actually getting past a cooperative iter so I will remove the write mod.",
            "accounts_in_message": [],
            "_revision_number": 5
        },
        {
            "id": "7391eac7f16107075f87bef6a13fb3105c760bf2",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 13:22:08.000000000",
            "message": "Uploaded patch set 6.",
            "accounts_in_message": [],
            "_revision_number": 6
        },
        {
            "id": "6677079deef076414a573f638fe9b66487e684c7",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 13:25:08.000000000",
            "message": "Uploaded patch set 7.",
            "accounts_in_message": [],
            "_revision_number": 7
        },
        {
            "id": "4711917e0cc361448da237319e9014a02ee23358",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 13:32:01.000000000",
            "message": "Uploaded patch set 8.",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "27eede90a98cdb4b6c164a22e214ce8f110dc7c3",
            "author": {
                "_account_id": 5494,
                "name": "Trivial Rebase",
                "email": "trivial-rebase@review.openstack.org",
                "username": "trivial-rebase"
            },
            "real_author": {
                "_account_id": 5494,
                "name": "Trivial Rebase",
                "email": "trivial-rebase@review.openstack.org",
                "username": "trivial-rebase"
            },
            "date": "2013-11-29 13:32:09.000000000",
            "message": "Patch Set 8:\n\nNew patchset patch-id matches previous patchset, but commit message has changed.",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "8249df768c825ecd3ee8dfd4f73736ae59222fb7",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-11-29 14:23:37.000000000",
            "message": "Patch Set 8: Doesn't seem to work\n\nBuild failed.  For information on how to proceed, see https://wiki.openstack.org/wiki/GerritJenkinsGit#Test_Failures\n\n- gate-glance-pep8 http://logs.openstack.org/40/54940/8/check/gate-glance-pep8/a20642c : SUCCESS in 2m 25s\n- gate-glance-docs http://docs-draft.openstack.org/40/54940/8/check/gate-glance-docs/6d5d1fd/doc/build/html/ : SUCCESS in 2m 06s\n- gate-glance-python26 http://logs.openstack.org/40/54940/8/check/gate-glance-python26/a01f1b0 : SUCCESS in 15m 38s\n- gate-glance-python27 http://logs.openstack.org/40/54940/8/check/gate-glance-python27/160de04 : SUCCESS in 12m 34s\n- check-tempest-devstack-vm-full http://logs.openstack.org/40/54940/8/check/check-tempest-devstack-vm-full/d3dc481 : SUCCESS in 51m 26s\n- check-tempest-devstack-vm-postgres-full http://logs.openstack.org/40/54940/8/check/check-tempest-devstack-vm-postgres-full/0344c84 : FAILURE in 13m 27s\n- check-tempest-devstack-vm-neutron http://logs.openstack.org/40/54940/8/check/check-tempest-devstack-vm-neutron/1349c1d : SUCCESS in 29m 33s\n- gate-tempest-devstack-vm-large-ops http://logs.openstack.org/40/54940/8/check/gate-tempest-devstack-vm-large-ops/cb5f48d : SUCCESS in 13m 17s\n- gate-tempest-devstack-vm-neutron-large-ops http://logs.openstack.org/40/54940/8/check/gate-tempest-devstack-vm-neutron-large-ops/33c1c56 : SUCCESS in 15m 14s\n- check-grenade-devstack-vm http://logs.openstack.org/40/54940/8/check/check-grenade-devstack-vm/214079c : SUCCESS in 33m 26s\n",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "2e3167b091f1a9c8e4db70d397b8645ca72298ec",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 14:31:24.000000000",
            "message": "Patch Set 8:\n\nLooks like there was a connection failure to http://mirror.rackspace.com. Seems to be ok now so...\n\nrecheck no bug",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "d909d9c56d1ee0b0a56d02eef2f5c76c7c341fec",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-11-29 17:19:18.000000000",
            "message": "Patch Set 8:\n\nrecheck no bug",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "30d36d1bc3c8a7452c7a3dfa76fdef5c2368222a",
            "author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "real_author": {
                "_account_id": 3,
                "name": "Jenkins",
                "username": "jenkins"
            },
            "date": "2013-11-29 17:56:52.000000000",
            "message": "Patch Set 8: Works for me\n\nBuild succeeded.\n\n- gate-glance-pep8 http://logs.openstack.org/40/54940/8/check/gate-glance-pep8/396113d : SUCCESS in 1m 56s\n- gate-glance-docs http://docs-draft.openstack.org/40/54940/8/check/gate-glance-docs/2d3404d/doc/build/html/ : SUCCESS in 2m 26s\n- gate-glance-python26 http://logs.openstack.org/40/54940/8/check/gate-glance-python26/c652807 : SUCCESS in 12m 54s\n- gate-glance-python27 http://logs.openstack.org/40/54940/8/check/gate-glance-python27/4f713f1 : SUCCESS in 13m 38s\n- check-tempest-devstack-vm-full http://logs.openstack.org/40/54940/8/check/check-tempest-devstack-vm-full/05f3df1 : SUCCESS in 34m 31s\n- check-tempest-devstack-vm-postgres-full http://logs.openstack.org/40/54940/8/check/check-tempest-devstack-vm-postgres-full/f9a12d1 : SUCCESS in 37m 25s\n- check-tempest-devstack-vm-neutron http://logs.openstack.org/40/54940/8/check/check-tempest-devstack-vm-neutron/ed00787 : SUCCESS in 32m 28s\n- gate-tempest-devstack-vm-large-ops http://logs.openstack.org/40/54940/8/check/gate-tempest-devstack-vm-large-ops/0143e68 : SUCCESS in 13m 47s\n- gate-tempest-devstack-vm-neutron-large-ops http://logs.openstack.org/40/54940/8/check/gate-tempest-devstack-vm-neutron-large-ops/64ff645 : SUCCESS in 17m 22s\n- check-grenade-devstack-vm http://logs.openstack.org/40/54940/8/check/check-grenade-devstack-vm/e93dde6 : SUCCESS in 22m 10s\n",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "c1b7888c9deafb5a30e0f484659498fe5fdf2c48",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-12-03 18:03:49.000000000",
            "message": "Patch Set 8:\n\nHi Ed,\n\nI ran our exerciser script before and after. I used 8 processes downloading a previously cached (to the local server) 10GB image (consisting of random data). (A little surprisingly) I didn't see any significant difference in fairness before and after.\n\n\nwithout the patch:\n\n $ glancealot -G -t glance -s 10000 -D 7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486- eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17- 43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7  -L -e https://localhost:9292 -n 8 \n 2013-12-03 16:47:04.979333\n ************ (8)x glance process download ***********\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 83.79 seconds): bandwidth 119.34 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 84.66 seconds): bandwidth 118.12 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 85.88 seconds): bandwidth 116.44 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 85.97 seconds): bandwidth 116.32 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 87.32 seconds): bandwidth 114.52 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 87.38 seconds): bandwidth 114.44 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 90.95 seconds): bandwidth 109.95 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 91.66 seconds): bandwidth 109.10 MB/s checksum check performed: False\n 8x GET aggregate: 80000.00 MB (8.00x10000.00) in 91.66 seconds: aggregate bandwidth 872.77 MB/s\n\n\nwith the patch:\n\n $ glancealot -G -t glance -s 10000 -D 7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7  -L -e https://localhost:9292 -n 8 \n 2013-12-03 16:50:51.819115\n ************ (8)x glance process download ***********\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 85.05 seconds): bandwidth 117.58 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 86.65 seconds): bandwidth 115.40 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 86.84 seconds): bandwidth 115.16 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 87.30 seconds): bandwidth 114.54 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 87.36 seconds): bandwidth 114.47 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 88.34 seconds): bandwidth 113.20 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 90.04 seconds): bandwidth 111.06 MB/s checksum check performed: False\n downloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 93.55 seconds): bandwidth 106.90 MB/s checksum check performed: False\n 8x GET aggregate: 80000.00 MB (8.00x10000.00) in 93.55 seconds: aggregate bandwidth 855.13 MB/s\n\nI can try your reproducer. What image side did you have? Were you running http or https? Thanks.",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "e9b02331d645f2f89b47fcc16e2734fdee713d9b",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-12-03 19:01:47.000000000",
            "message": "Patch Set 8:\n\nStuart, fair enough thanks for running those tests. I ran 8 threads of 2G images using http and could definitely see a difference in the balancing of the downloads but on average I suppose the results are very similar to yours and probably not worthy of being called \"significant\". I do wonder whether the result would change at higher concurrencies which would presumably put higher strain on the eventlet scheduler. I think I'll leave it up to you to call whether or not we should poceed with this since currently it is more of a theoretical performance gain than one that I can prove to be significant.",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "113303cb9a35c6bda591f432a365f5c240f497df",
            "author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "real_author": {
                "_account_id": 455,
                "name": "Stuart McLaren",
                "email": "stuart.mclaren@hpe.com",
                "username": "stuart-mclaren"
            },
            "date": "2013-12-05 13:03:57.000000000",
            "message": "Patch Set 8: I would prefer that you didn't merge this\n\nI tried with a larger number of threads - but didn't notice any improvement.\nThere wasn't perfect fairness, so there may be some opportunity to improve things,\nit just seems that this patch set doesn't do the trick.\n\nwithout:\n\n$ glancealot -G -t glance -s 10000 -D 7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8482-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7  -L -e https://localhost:9292 -n 32\n2013-12-04 10:05:27.019219\n************ (32)x glance process download ***********\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 232.39 seconds): bandwidth 43.03 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 232.81 seconds): bandwidth 42.95 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 235.86 seconds): bandwidth 42.40 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 236.95 seconds): bandwidth 42.20 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 237.71 seconds): bandwidth 42.07 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 237.77 seconds): bandwidth 42.06 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 239.21 seconds): bandwidth 41.80 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 257.45 seconds): bandwidth 38.84 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 262.63 seconds): bandwidth 38.08 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 264.08 seconds): bandwidth 37.87 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 267.88 seconds): bandwidth 37.33 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 268.74 seconds): bandwidth 37.21 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 271.57 seconds): bandwidth 36.82 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 273.20 seconds): bandwidth 36.60 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 274.03 seconds): bandwidth 36.49 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 275.97 seconds): bandwidth 36.24 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 277.28 seconds): bandwidth 36.06 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 278.57 seconds): bandwidth 35.90 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.11 seconds): bandwidth 35.83 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.37 seconds): bandwidth 35.80 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.40 seconds): bandwidth 35.79 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.41 seconds): bandwidth 35.79 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.48 seconds): bandwidth 35.78 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.53 seconds): bandwidth 35.77 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.62 seconds): bandwidth 35.76 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 279.71 seconds): bandwidth 35.75 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 280.04 seconds): bandwidth 35.71 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 280.19 seconds): bandwidth 35.69 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 280.82 seconds): bandwidth 35.61 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 281.70 seconds): bandwidth 35.50 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 323.72 seconds): bandwidth 30.89 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 338.72 seconds): bandwidth 29.52 MB/s checksum check performed: False\n32x GET aggregate: 320000.00 MB (32.00x10000.00) in 338.75 seconds: aggregate bandwidth 944.64 MB/s\n\nwith\n\n$ glancealot -G -t glance -s 10000 -D 7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7,7b63629e-3b17-43c2-8486-eb3b61c77ac7  -L -e https://localhost:9292 -n 32\n2013-12-04 15:28:56.086495\n************ (32)x glance process download ***********\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 193.60 seconds): bandwidth 51.65 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 193.68 seconds): bandwidth 51.63 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 193.99 seconds): bandwidth 51.55 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 194.64 seconds): bandwidth 51.38 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 195.72 seconds): bandwidth 51.09 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 195.85 seconds): bandwidth 51.06 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 195.84 seconds): bandwidth 51.06 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 196.82 seconds): bandwidth 50.81 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 197.56 seconds): bandwidth 50.62 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 197.68 seconds): bandwidth 50.59 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 294.18 seconds): bandwidth 33.99 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 294.21 seconds): bandwidth 33.99 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 294.38 seconds): bandwidth 33.97 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 294.49 seconds): bandwidth 33.96 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 294.56 seconds): bandwidth 33.95 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 294.74 seconds): bandwidth 33.93 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 296.34 seconds): bandwidth 33.75 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 296.41 seconds): bandwidth 33.74 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 297.00 seconds): bandwidth 33.67 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 297.11 seconds): bandwidth 33.66 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 297.10 seconds): bandwidth 33.66 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 297.23 seconds): bandwidth 33.64 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 297.48 seconds): bandwidth 33.62 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 297.50 seconds): bandwidth 33.61 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 298.45 seconds): bandwidth 33.51 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 298.44 seconds): bandwidth 33.51 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 353.28 seconds): bandwidth 28.31 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 353.29 seconds): bandwidth 28.31 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 353.31 seconds): bandwidth 28.30 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 353.49 seconds): bandwidth 28.29 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 353.52 seconds): bandwidth 28.29 MB/s checksum check performed: False\ndownloaded image 7b63629e-3b17-43c2-8486-eb3b61c77ac7 (10000 MB in 353.49 seconds): bandwidth 28.29 MB/s checksum check performed: False\n32x GET aggregate: 320000.00 MB (32.00x10000.00) in 353.53 seconds: aggregate bandwidth 905.16 MB/s",
            "accounts_in_message": [],
            "_revision_number": 8
        },
        {
            "id": "dbc44d9148b2458f22f740a4e2ef1080e8f890ae",
            "author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "real_author": {
                "_account_id": 6737,
                "name": "Edward Hope-Morley",
                "email": "edward.hope-morley@canonical.com",
                "username": "hopem"
            },
            "date": "2013-12-05 13:18:42.000000000",
            "message": "Patch Set 8: Abandoned\n\nNo significant improvement detected after this change is applied so abandoning. Thanks for testing this Stuart.",
            "accounts_in_message": [],
            "_revision_number": 8
        }
    ],
    "requirements": [],
    "submit_records": []
}